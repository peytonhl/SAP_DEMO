2025-07-13 14:40:06,263 - data_manager - INFO - Created sample SAP data
2025-07-13 15:52:19,124 - data_manager - INFO - Loaded existing mock SAP data
2025-07-13 15:52:19,287 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 15:52:19,287 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 15:52:19,295 - werkzeug - INFO -  * Restarting with stat
2025-07-13 15:52:21,442 - data_manager - INFO - Loaded existing mock SAP data
2025-07-13 15:52:21,485 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 15:52:21,526 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 15:52:37,062 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 15:52:37] "GET / HTTP/1.1" 200 -
2025-07-13 15:52:37,451 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 15:52:37] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 15:52:52,763 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T15:52:52.763096",
  "operation": "query_routed",
  "table": "overdue_invoices",
  "record_count": 2,
  "filters": {
    "original_question": "Show me overdue invoices"
  }
}
2025-07-13 15:52:52,767 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T15:52:52.767103",
  "error_type": "ai_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": {
    "question": "Show me overdue invoices"
  }
}
2025-07-13 15:52:52,768 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T15:52:52.768104",
  "error_type": "app_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "Show me overdue invoices"
  }
}
2025-07-13 15:52:52,778 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 15:52:52] "POST / HTTP/1.1" 200 -
2025-07-13 16:12:27,527 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 16:12:27,884 - werkzeug - INFO -  * Restarting with stat
2025-07-13 16:12:35,602 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 16:12:35,638 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 16:13:01,300 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\prompt_templates.py', reloading
2025-07-13 16:13:01,535 - werkzeug - INFO -  * Restarting with stat
2025-07-13 16:17:53,011 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 16:17:53,011 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 16:17:53,013 - werkzeug - INFO -  * Restarting with stat
2025-07-13 16:17:55,513 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 16:17:55,528 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 16:18:23,803 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 16:18:23] "GET / HTTP/1.1" 200 -
2025-07-13 20:08:36,757 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:08:36] "GET / HTTP/1.1" 200 -
2025-07-13 20:39:15,026 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 20:39:15,027 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 20:39:15,029 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:39:17,124 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:39:17,142 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:39:27,938 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:39:27] "GET / HTTP/1.1" 200 -
2025-07-13 20:39:43,576 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bkpf.csv
2025-07-13 20:39:43,577 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:39:43.577570",
  "error_type": "file_upload_error",
  "error_message": "local variable 'df' referenced before assignment",
  "context": null
}
2025-07-13 20:39:43,580 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:39:43] "POST /upload HTTP/1.1" 200 -
2025-07-13 20:40:28,621 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 20:40:28,623 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:40:28.623354",
  "error_type": "file_upload_error",
  "error_message": "local variable 'df' referenced before assignment",
  "context": null
}
2025-07-13 20:40:28,624 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:40:28] "POST /upload HTTP/1.1" 200 -
2025-07-13 20:41:08,701 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 20:41:09,413 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:45:53,166 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 20:45:53,167 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 20:45:53,169 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:45:55,393 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:45:55,406 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:46:12,306 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:12] "GET / HTTP/1.1" 200 -
2025-07-13 20:46:19,821 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 20:46:19,823 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 20:46:19,824 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T20:46:19.824248",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 20:46:19,826 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:19] "POST /upload HTTP/1.1" 200 -
2025-07-13 20:46:19,907 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:19] "GET / HTTP/1.1" 200 -
2025-07-13 20:46:20,047 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:20] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 20:46:46,192 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 20:46:46,211 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-13 20:46:46,212 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:46:46.212572",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 20:46:46,216 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:46:46.216528",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does "
  }
}
2025-07-13 20:46:46,357 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:46] "[35m[1mPOST / HTTP/1.1[0m" 500 -
2025-07-13 20:46:46,496 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:46] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
2025-07-13 20:46:46,497 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:46] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
2025-07-13 20:46:46,568 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:46] "GET /?__debugger__=yes&cmd=resource&f=console.png&s=KeiRyFkl8K9LY5HVRx9G HTTP/1.1" 200 -
2025-07-13 20:46:46,631 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:46:46] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
2025-07-13 20:48:24,236 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 20:48:24,590 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:48:30,574 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:48:30,613 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:49:04,675 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 20:49:04,992 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:49:12,002 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:49:12,037 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:49:21,019 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 20:49:21,338 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:49:29,347 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:49:29,379 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:49:55,281 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 20:49:55,289 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-13 20:49:55,291 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:49:55.291565",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 20:49:55,292 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-13T20:49:55.292575",
  "user_question": "Show all records",
  "ai_response": "Unable to generate AI insights: \n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "processing_time_seconds": 0.015281438827514648,
  "data_context": {
    "file_info": {
      "total_rows": 15,
      "total_columns": 14
    },
    "sap_table_type": "BKPF",
    "schema_summary": "Test schema"
  }
}
2025-07-13 20:52:40,790 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:52:40] "GET / HTTP/1.1" 200 -
2025-07-13 20:52:46,187 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 20:52:46,189 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 20:52:46,191 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T20:52:46.190373",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 20:52:46,192 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:52:46] "POST /upload HTTP/1.1" 200 -
2025-07-13 20:52:46,314 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:52:46] "GET / HTTP/1.1" 200 -
2025-07-13 20:52:54,573 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 20:52:54,590 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-13 20:52:54,591 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:52:54.591114",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 20:52:54,592 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:52:54.592119",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 20:52:54,612 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:52:54] "POST / HTTP/1.1" 200 -
2025-07-13 20:53:41,641 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:53:41] "POST / HTTP/1.1" 200 -
2025-07-13 20:54:06,144 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 20:54:06,572 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:54:11,612 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:54:11,631 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:54:24,542 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 20:54:24,789 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:54:32,093 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:54:32,129 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:54:44,877 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 20:54:45,121 - werkzeug - INFO -  * Restarting with stat
2025-07-13 20:54:51,680 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 20:54:51,717 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 20:56:13,139 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:56:13] "POST / HTTP/1.1" 200 -
2025-07-13 20:56:21,526 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 20:56:21,529 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 20:56:21,530 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T20:56:21.529126",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 20:56:21,540 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:56:21] "POST /upload HTTP/1.1" 200 -
2025-07-13 20:56:23,777 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:56:23] "POST / HTTP/1.1" 200 -
2025-07-13 20:56:33,561 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:56:33] "POST / HTTP/1.1" 200 -
2025-07-13 20:56:43,870 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 20:56:43,870 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:56:43.870664",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 20:56:43,871 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T20:56:43.871676",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "tell me what this report does"
  }
}
2025-07-13 20:56:43,893 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 20:56:43] "POST / HTTP/1.1" 200 -
2025-07-13 21:02:02,852 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:02:03,145 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:02:11,606 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:02:11,656 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:03:51,054 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:03:51] "POST / HTTP/1.1" 200 -
2025-07-13 21:03:55,812 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:03:55,814 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:03:55,817 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:03:55.817741",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:03:55,822 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:03:55] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:03:57,383 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:03:57,412 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:03:57.412633",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:03:57,440 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:03:57.439733",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "tell me what this report does"
  }
}
2025-07-13 21:03:57,535 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:03:57] "POST / HTTP/1.1" 200 -
2025-07-13 21:04:14,309 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 21:04:14,310 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 21:04:14,314 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:04:22,712 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:04:22,765 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:04:30,612 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:04:30] "GET / HTTP/1.1" 200 -
2025-07-13 21:04:38,944 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:04:38,945 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:04:38,945 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:04:38.945759",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:04:38,947 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:04:38] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:04:39,042 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:04:39] "GET / HTTP/1.1" 200 -
2025-07-13 21:04:58,027 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:04:58,027 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:04:58.027003",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:04:58,028 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:04:58.028295",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:04:58,060 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:04:58] "POST / HTTP/1.1" 200 -
2025-07-13 21:07:09,988 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 21:07:10,375 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:07:17,535 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:07:17,572 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:07:48,588 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:07:48,991 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:07:56,183 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:07:56,227 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:08:10,711 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:08:11,038 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:08:20,590 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:08:20,686 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:08:31,926 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:08:32,179 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:08:39,712 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:08:39,746 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:09:00,787 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:09:01,041 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:09:08,093 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:09:08,129 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:13:27,645 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 21:13:27,950 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:13:34,843 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:13:34,883 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:13:43,452 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:13:43,757 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:13:50,780 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:13:50,813 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:14:04,405 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:14:04,712 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:14:12,051 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:14:12,084 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:17:32,733 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 21:17:33,026 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:17:39,429 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:17:39,458 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:19:12,975 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:19:12] "POST / HTTP/1.1" 200 -
2025-07-13 21:19:13,143 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:19:13] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 21:19:19,862 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:19:19,864 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:19:19,868 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:19:19.867893",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:19:19,870 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:19:19] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:19:21,192 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:19:21,200 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:19:21.200200",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:19:21,240 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:19:21.240479",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:19:21,377 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:19:21] "POST / HTTP/1.1" 200 -
2025-07-13 21:19:29,604 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:19:29,604 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:19:29.604556",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:19:29,605 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:19:29.605766",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:19:29,645 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:19:29] "POST / HTTP/1.1" 200 -
2025-07-13 21:25:33,432 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:25:33,756 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:25:38,723 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:25:38,742 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:26:01,920 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:26:02,195 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:26:09,457 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:26:09,493 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:26:18,339 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:26:18,585 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:26:23,974 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:26:24,008 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:26:52,407 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 21:26:52,706 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:27:00,355 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:27:00,390 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:31:33,056 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:31:33] "POST / HTTP/1.1" 200 -
2025-07-13 21:31:33,385 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:31:33] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 21:31:43,689 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:31:43,690 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:31:43,691 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:31:43.691475",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:31:43,692 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:31:43] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:31:48,724 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:31:48,725 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:31:48.725341",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:31:48,726 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:31:48.726887",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:31:48,775 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:31:48] "POST / HTTP/1.1" 200 -
2025-07-13 21:31:51,550 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:31:51,551 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:31:51.551768",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:31:51,553 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:31:51.553287",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:31:51,610 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:31:51] "POST / HTTP/1.1" 200 -
2025-07-13 21:32:06,356 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:32:06] "GET / HTTP/1.1" 200 -
2025-07-13 21:32:14,784 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:32:14,787 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:32:14,789 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:32:14.789573",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:32:14,791 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:32:14] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:32:14,970 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:32:14] "GET / HTTP/1.1" 200 -
2025-07-13 21:32:15,397 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:32:15] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 21:32:20,520 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:32:20,520 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:32:20.520803",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:32:20,522 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:32:20.522881",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "what does this report do?"
  }
}
2025-07-13 21:32:20,582 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:32:20] "POST / HTTP/1.1" 200 -
2025-07-13 21:40:14,270 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\debug_test.py', reloading
2025-07-13 21:40:14,504 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:40:19,983 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:40:20,028 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:41:09,724 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 21:41:10,080 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:41:16,640 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:41:16,691 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:42:00,910 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:42:01,271 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:42:07,674 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:42:07,712 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:42:25,859 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:42:26,106 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:42:33,009 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:42:33,042 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:43:28,144 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 21:43:28,145 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 21:43:28,151 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:43:36,831 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:43:36,875 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:46:48,822 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:46:48] "GET / HTTP/1.1" 200 -
2025-07-13 21:46:55,499 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:46:55,502 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:46:55,504 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:46:55.504602",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:46:55,506 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:46:55] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:46:55,650 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:46:55] "GET / HTTP/1.1" 200 -
2025-07-13 21:46:55,860 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:46:55] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 21:47:03,319 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:47:03,320 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:47:03.320291",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:47:03,321 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:47:03.321297",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:47:03,378 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:47:03] "POST / HTTP/1.1" 200 -
2025-07-13 21:50:06,434 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:50:06,821 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:50:08,411 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:50:08,821 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:50:15,617 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:50:15,658 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:50:17,062 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:50:17,109 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:50:25,810 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 21:50:26,129 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:50:26,322 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-13 21:50:26,641 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:50:33,925 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:50:33,960 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:50:34,249 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:50:34,290 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:52:01,400 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:52:01] "GET / HTTP/1.1" 200 -
2025-07-13 21:52:06,895 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:52:06,901 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:52:06,904 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:52:06.903977",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:52:06,908 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:52:06] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:52:07,080 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:52:07] "GET / HTTP/1.1" 200 -
2025-07-13 21:52:07,468 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:52:07] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 21:52:13,045 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:52:13,047 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:52:13.047396",
  "error_type": "ai_insights_error",
  "error_message": "\n\nYou tried to access openai.ChatCompletion, but this is no longer supported in openai>=1.0.0 - see the README at https://github.com/openai/openai-python for the API.\n\nYou can run `openai migrate` to automatically upgrade your codebase to use the 1.0.0 interface. \n\nAlternatively, you can pin your installation to the old version, e.g. `pip install openai==0.28`\n\nA detailed migration guide is available here: https://github.com/openai/openai-python/discussions/742\n",
  "context": null
}
2025-07-13 21:52:13,049 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:52:13.049740",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 21:52:13,143 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:52:13] "POST / HTTP/1.1" 200 -
2025-07-13 21:53:33,952 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:53:34,273 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:53:35,247 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:53:35,526 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:53:41,205 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:53:41,232 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:53:41,877 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:53:41,898 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:53:56,544 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:53:56] "GET / HTTP/1.1" 200 -
2025-07-13 21:54:04,003 - schema_analyzer - INFO - Schema analysis completed for uploads\d69cf5b5-0b7a-4aee-ab98-ecc984ad895b_sample_bseg.csv
2025-07-13 21:54:04,010 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 21:54:04,013 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T21:54:04.011747",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "d69cf5b5-0b7a-4aee-ab98-ecc984ad895b",
    "file_size_mb": 0.0
  }
}
2025-07-13 21:54:04,028 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:54:04] "POST /upload HTTP/1.1" 200 -
2025-07-13 21:54:04,236 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:54:04] "GET / HTTP/1.1" 200 -
2025-07-13 21:54:08,255 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 21:54:08,257 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-13 21:54:08,276 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-13 21:54:11,600 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-70beef00-02d3-4ffc-ba5a-a1ef9298a0ab', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'test'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 21:54:11,604 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 21:54:11,605 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 21:54:11,715 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001A44B2E3DC0>
2025-07-13 21:54:11,716 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001A44A8B3E40> server_hostname='api.openai.com' timeout=5.0
2025-07-13 21:54:11,749 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001A44B2E3C10>
2025-07-13 21:54:11,750 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 21:54:11,751 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 21:54:11,752 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 21:54:11,753 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 21:54:11,753 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 21:54:12,251 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 429, b'Too Many Requests', [(b'Date', b'Mon, 14 Jul 2025 01:54:12 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'337'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_3c17b013055779224b52a58398ab82ce'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=3Qazuv1HUV.vJ6oagrSWQe5C3qRRUp_ZYZX45eQgthk-1752458052-1.0.1.1-Q8hfF.9HwXv3Gz1TCEPob1exBSDMUPYUNTqGjVWynfs_A_yYyq9SBOWhn.b9Ui.lyXioe5dtQciZ4p_CpL3_q5d63eIc_gqYP6E.x03t5yc; path=/; expires=Mon, 14-Jul-25 02:24:12 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=Yks_4shczDdo4tCe2GZS2eh1Da3pOaHaqhMuibFKXws-1752458052506-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed64092b08748d-MIA'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 21:54:12,253 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-07-13 21:54:12,254 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 21:54:12,255 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 21:54:12,255 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 21:54:12,256 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 21:54:12,256 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "429 Too Many Requests" Headers([('date', 'Mon, 14 Jul 2025 01:54:12 GMT'), ('content-type', 'application/json; charset=utf-8'), ('content-length', '337'), ('connection', 'keep-alive'), ('vary', 'Origin'), ('x-request-id', 'req_3c17b013055779224b52a58398ab82ce'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=3Qazuv1HUV.vJ6oagrSWQe5C3qRRUp_ZYZX45eQgthk-1752458052-1.0.1.1-Q8hfF.9HwXv3Gz1TCEPob1exBSDMUPYUNTqGjVWynfs_A_yYyq9SBOWhn.b9Ui.lyXioe5dtQciZ4p_CpL3_q5d63eIc_gqYP6E.x03t5yc; path=/; expires=Mon, 14-Jul-25 02:24:12 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=Yks_4shczDdo4tCe2GZS2eh1Da3pOaHaqhMuibFKXws-1752458052506-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95ed64092b08748d-MIA'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-13 21:54:12,256 - openai._base_client - DEBUG - request_id: req_3c17b013055779224b52a58398ab82ce
2025-07-13 21:54:12,256 - openai._base_client - DEBUG - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "C:\Users\peytonhl\AppData\Roaming\Python\Python38\site-packages\openai\_base_client.py", line 1024, in request
    response.raise_for_status()
  File "C:\Users\peytonhl\AppData\Roaming\Python\Python38\site-packages\httpx\_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-07-13 21:54:12,277 - openai._base_client - DEBUG - Retrying due to status code 429
2025-07-13 21:54:12,278 - openai._base_client - DEBUG - 2 retries left
2025-07-13 21:54:12,278 - openai._base_client - INFO - Retrying request to /chat/completions in 0.409847 seconds
2025-07-13 21:54:12,689 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-70beef00-02d3-4ffc-ba5a-a1ef9298a0ab', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'test'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 21:54:12,691 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 21:54:12,692 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 21:54:12,692 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 21:54:12,693 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 21:54:12,693 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 21:54:12,693 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 21:54:13,183 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 429, b'Too Many Requests', [(b'Date', b'Mon, 14 Jul 2025 01:54:13 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'337'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_1f30a3d84b3eaf29787ec04e53125a59'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed640f0a2e748d-MIA'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 21:54:13,184 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-07-13 21:54:13,185 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 21:54:13,185 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 21:54:13,185 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 21:54:13,185 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 21:54:13,186 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "429 Too Many Requests" Headers({'date': 'Mon, 14 Jul 2025 01:54:13 GMT', 'content-type': 'application/json; charset=utf-8', 'content-length': '337', 'connection': 'keep-alive', 'vary': 'Origin', 'x-request-id': 'req_1f30a3d84b3eaf29787ec04e53125a59', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '95ed640f0a2e748d-MIA', 'alt-svc': 'h3=":443"; ma=86400'})
2025-07-13 21:54:13,186 - openai._base_client - DEBUG - request_id: req_1f30a3d84b3eaf29787ec04e53125a59
2025-07-13 21:54:13,186 - openai._base_client - DEBUG - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "C:\Users\peytonhl\AppData\Roaming\Python\Python38\site-packages\openai\_base_client.py", line 1024, in request
    response.raise_for_status()
  File "C:\Users\peytonhl\AppData\Roaming\Python\Python38\site-packages\httpx\_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-07-13 21:54:13,187 - openai._base_client - DEBUG - Retrying due to status code 429
2025-07-13 21:54:13,187 - openai._base_client - DEBUG - 1 retry left
2025-07-13 21:54:13,187 - openai._base_client - INFO - Retrying request to /chat/completions in 0.819621 seconds
2025-07-13 21:54:14,009 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-70beef00-02d3-4ffc-ba5a-a1ef9298a0ab', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'test'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 21:54:14,010 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 21:54:14,010 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 21:54:14,010 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 21:54:14,010 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 21:54:14,012 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 21:54:14,012 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 21:54:14,113 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 429, b'Too Many Requests', [(b'Date', b'Mon, 14 Jul 2025 01:54:14 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'337'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_7b10e91a8d0bab7873c10de7378cf93a'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed64174caa748d-MIA'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 21:54:14,114 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-07-13 21:54:14,115 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 21:54:14,115 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 21:54:14,115 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 21:54:14,115 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 21:54:14,117 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "429 Too Many Requests" Headers({'date': 'Mon, 14 Jul 2025 01:54:14 GMT', 'content-type': 'application/json; charset=utf-8', 'content-length': '337', 'connection': 'keep-alive', 'vary': 'Origin', 'x-request-id': 'req_7b10e91a8d0bab7873c10de7378cf93a', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '95ed64174caa748d-MIA', 'alt-svc': 'h3=":443"; ma=86400'})
2025-07-13 21:54:14,117 - openai._base_client - DEBUG - request_id: req_7b10e91a8d0bab7873c10de7378cf93a
2025-07-13 21:54:14,117 - openai._base_client - DEBUG - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "C:\Users\peytonhl\AppData\Roaming\Python\Python38\site-packages\openai\_base_client.py", line 1024, in request
    response.raise_for_status()
  File "C:\Users\peytonhl\AppData\Roaming\Python\Python38\site-packages\httpx\_models.py", line 761, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-07-13 21:54:14,118 - openai._base_client - DEBUG - Re-raising status error
2025-07-13 21:54:14,120 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:54:14.120555",
  "error_type": "ai_insights_error",
  "error_message": "Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}",
  "context": null
}
2025-07-13 21:54:14,121 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T21:54:14.121554",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "test"
  }
}
2025-07-13 21:54:14,185 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 21:54:14] "POST / HTTP/1.1" 200 -
2025-07-13 21:56:14,688 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:56:15,395 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:56:19,069 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:56:20,075 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:56:32,855 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:56:32,920 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:56:36,164 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:56:36,240 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 21:56:44,857 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 21:56:45,233 - werkzeug - INFO -  * Restarting with stat
2025-07-13 21:56:56,939 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 21:56:57,026 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:20:34,666 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 22:20:34,682 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 22:20:34,694 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:20:40,950 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:20:40,986 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:21:10,986 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:21:10] "GET / HTTP/1.1" 200 -
2025-07-13 22:21:11,532 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:21:11] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 22:21:28,228 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-13 22:21:28,243 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 22:21:28,246 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T22:21:28.245259",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": 0.0
  }
}
2025-07-13 22:21:28,261 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:21:28] "POST /upload HTTP/1.1" 200 -
2025-07-13 22:21:28,529 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:21:28] "GET / HTTP/1.1" 200 -
2025-07-13 22:21:33,385 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 22:21:33,392 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-13 22:21:33,400 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-13 22:21:35,102 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-59f5c5ac-8c3b-418c-976a-9d51a4d2f40b', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'explain to me what this report does'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 22:21:35,107 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 22:21:35,110 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 22:21:35,224 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000027B033ED640>
2025-07-13 22:21:35,225 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000027B02B9D640> server_hostname='api.openai.com' timeout=5.0
2025-07-13 22:21:35,252 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000027B033EDD60>
2025-07-13 22:21:35,253 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 22:21:35,256 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 22:21:35,256 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 22:21:35,256 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 22:21:35,257 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 22:21:44,852 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 02:21:45 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'9345'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'9347'), (b'x-ratelimit-limit-requests', b'200'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'199'), (b'x-ratelimit-remaining-tokens', b'9244'), (b'x-ratelimit-reset-requests', b'7m12s'), (b'x-ratelimit-reset-tokens', b'4.536s'), (b'x-request-id', b'req_b311483d7dddac1a55210db44ef1bf95'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=m6zzxXpv2LDnQRarUsBDhQ3kDPqQund2mrt4tD4St18-1752459705-1.0.1.1-6KXZkcO8ySt_04xDsWqf5XHyfMAoeiaS_DRIUgAE3D3iVv0yCLcX8MFL8n9z74gzNmDS.8I_fJ443iElXTtUWRgHjJslKbXVyPXL8v0Wvpo; path=/; expires=Mon, 14-Jul-25 02:51:45 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=h47qzV6lEh36OB5eXeVVfAE1H1Zd4rzQQTQArUcuep8-1752459705127-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed8c2929b7b08a-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 22:21:44,855 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-13 22:21:44,856 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 22:21:44,857 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 22:21:44,858 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 22:21:44,858 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 22:21:44,859 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 14 Jul 2025 02:21:45 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '9345'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '9347'), ('x-ratelimit-limit-requests', '200'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '199'), ('x-ratelimit-remaining-tokens', '9244'), ('x-ratelimit-reset-requests', '7m12s'), ('x-ratelimit-reset-tokens', '4.536s'), ('x-request-id', 'req_b311483d7dddac1a55210db44ef1bf95'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=m6zzxXpv2LDnQRarUsBDhQ3kDPqQund2mrt4tD4St18-1752459705-1.0.1.1-6KXZkcO8ySt_04xDsWqf5XHyfMAoeiaS_DRIUgAE3D3iVv0yCLcX8MFL8n9z74gzNmDS.8I_fJ443iElXTtUWRgHjJslKbXVyPXL8v0Wvpo; path=/; expires=Mon, 14-Jul-25 02:51:45 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=h47qzV6lEh36OB5eXeVVfAE1H1Zd4rzQQTQArUcuep8-1752459705127-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95ed8c2929b7b08a-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-13 22:21:44,859 - openai._base_client - DEBUG - request_id: req_b311483d7dddac1a55210db44ef1bf95
2025-07-13 22:21:44,874 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-13T22:21:44.874639",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1512,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "explain to me what this report does"
}
2025-07-13 22:21:44,876 - sap_demo.app - ERROR - Error: {
  "timestamp": "2025-07-13T22:21:44.876690",
  "error_type": "query_processing_error",
  "error_message": "Object of type int64 is not JSON serializable",
  "context": {
    "question": "explain to me what this report does"
  }
}
2025-07-13 22:21:44,953 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:21:44] "POST / HTTP/1.1" 200 -
2025-07-13 22:21:49,909 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:21:49] "GET / HTTP/1.1" 200 -
2025-07-13 22:23:10,802 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\logger_config.py', reloading
2025-07-13 22:23:11,744 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:23:13,864 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\logger_config.py', reloading
2025-07-13 22:23:14,578 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:23:16,932 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\logger_config.py', reloading
2025-07-13 22:23:17,374 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:23:22,225 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:23:22,274 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:23:24,431 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:23:24,584 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:23:27,127 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:23:27,169 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:24:06,890 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 22:24:06,892 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 22:24:06,895 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:24:12,408 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:24:12,437 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:24:45,084 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:24:45] "GET / HTTP/1.1" 200 -
2025-07-13 22:24:51,821 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-13 22:24:51,829 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 22:24:51,861 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T22:24:51.861237",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": "0.0"
  }
}
2025-07-13 22:24:51,898 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:24:51] "POST /upload HTTP/1.1" 200 -
2025-07-13 22:24:52,112 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:24:52] "GET / HTTP/1.1" 200 -
2025-07-13 22:24:57,902 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 22:24:57,907 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-13 22:24:57,917 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-13 22:24:59,894 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-6787c75f-145a-4c62-a020-fe0c8b9c6ee6', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'explain to me what this report does'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 22:24:59,900 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 22:24:59,901 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 22:24:59,966 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001CB767CFD60>
2025-07-13 22:24:59,966 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001CB761C59C0> server_hostname='api.openai.com' timeout=5.0
2025-07-13 22:24:59,993 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001CB7680ADC0>
2025-07-13 22:24:59,993 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 22:24:59,994 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 22:24:59,994 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 22:24:59,995 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 22:24:59,995 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 22:25:03,622 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 02:25:03 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'3438'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3440'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9972'), (b'x-ratelimit-remaining-tokens', b'9244'), (b'x-ratelimit-reset-requests', b'3m55.945s'), (b'x-ratelimit-reset-tokens', b'4.536s'), (b'x-request-id', b'req_6a8952842599e83a534b33e8b59aedbf'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=a2gOZmzG62ilrGLs6SBj6a94QaHeAih_wd0pY.bnU2c-1752459903-1.0.1.1-C4kfjeDIfWmbRrF64OYg1vySE9zPWZ.3xItA87RZr2kiL7TP.j8680jitntrK0TFyldr1uFg1CPlze.08K8vUrz3k2q4kvXQSUsO1GWyQjc; path=/; expires=Mon, 14-Jul-25 02:55:03 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=G6n3qyv78bdPce6q3tQoTS_dyPbhQqP97W_KJkVgnYg-1752459903896-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed9128cf4b74b4-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 22:25:03,624 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-13 22:25:03,625 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 22:25:03,626 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 22:25:03,627 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 22:25:03,627 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 22:25:03,627 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 14 Jul 2025 02:25:03 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '3438'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '3440'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9972'), ('x-ratelimit-remaining-tokens', '9244'), ('x-ratelimit-reset-requests', '3m55.945s'), ('x-ratelimit-reset-tokens', '4.536s'), ('x-request-id', 'req_6a8952842599e83a534b33e8b59aedbf'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=a2gOZmzG62ilrGLs6SBj6a94QaHeAih_wd0pY.bnU2c-1752459903-1.0.1.1-C4kfjeDIfWmbRrF64OYg1vySE9zPWZ.3xItA87RZr2kiL7TP.j8680jitntrK0TFyldr1uFg1CPlze.08K8vUrz3k2q4kvXQSUsO1GWyQjc; path=/; expires=Mon, 14-Jul-25 02:55:03 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=G6n3qyv78bdPce6q3tQoTS_dyPbhQqP97W_KJkVgnYg-1752459903896-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95ed9128cf4b74b4-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-13 22:25:03,629 - openai._base_client - DEBUG - request_id: req_6a8952842599e83a534b33e8b59aedbf
2025-07-13 22:25:03,648 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-13T22:25:03.648240",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 459,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "explain to me what this report does"
}
2025-07-13 22:25:03,658 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-13T22:25:03.652424",
  "user_question": "explain to me what this report does",
  "ai_response": "I'm sorry, but I can't provide insights or recommendations as there's no specific report or data provided. Could you please provide more details or context about the report you're referring to? For example, are you asking about a specific SAP financial report, such as a Profit and Loss Statement, Balance Sheet, or Vendor Aging Report? Or perhaps you're referring to a custom report or analysis? The more details you can provide, the better I can assist you.",
  "processing_time_seconds": 5.792850971221924,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-13 22:25:03,837 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:25:03] "POST / HTTP/1.1" 200 -
2025-07-13 22:26:25,488 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 22:26:25,962 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:26:26,348 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 22:26:26,744 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:26:29,622 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 22:26:30,141 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:26:30,694 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-13 22:26:31,126 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:26:36,861 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:26:36,977 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:26:38,027 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:26:38,276 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:26:42,327 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:26:42,381 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:26:43,442 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:26:43,579 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:28:31,511 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:28:31] "GET / HTTP/1.1" 200 -
2025-07-13 22:28:37,274 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-13 22:28:37,280 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 22:28:37,288 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T22:28:37.287256",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": "0.0"
  }
}
2025-07-13 22:28:37,310 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:28:37] "POST /upload HTTP/1.1" 200 -
2025-07-13 22:28:37,580 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:28:37] "GET / HTTP/1.1" 200 -
2025-07-13 22:28:41,995 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 22:28:42,002 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-13 22:28:42,007 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-13 22:28:43,426 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-cadd5481-6969-4576-a7b5-38661a457143', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'explain to me what this report does'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 22:28:43,428 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 22:28:43,431 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 22:28:43,535 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000194C7D46D60>
2025-07-13 22:28:43,535 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000194C7DD42C0> server_hostname='api.openai.com' timeout=5.0
2025-07-13 22:28:43,561 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000194C7D46BB0>
2025-07-13 22:28:43,562 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 22:28:43,562 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 22:28:43,562 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 22:28:43,564 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 22:28:43,564 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 22:28:48,417 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 02:28:48 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'4312'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4316'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9997'), (b'x-ratelimit-remaining-tokens', b'9244'), (b'x-ratelimit-reset-requests', b'20.683s'), (b'x-ratelimit-reset-tokens', b'4.536s'), (b'x-request-id', b'req_b9599249139079c75dd150887049c5d3'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=KG0H33fYAE3qofy3oN77HA93z3m3ya5rbSNddy8B8jY-1752460128-1.0.1.1-goGX9WrlvgW2LdrL77J_3tIS7iTjWxx9nT5gQ4s4F2iI91PjoV2wjEfszLIxtyNmAQx13_S7ajA0dg4fCMJWGinHrjd37yt6fHZTgZeNDt4; path=/; expires=Mon, 14-Jul-25 02:58:48 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=.riM7q1Xo1dNTlYOkiHrkD0Yc6tuR3QFIJpmoXVe8Ug-1752460128696-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed969e1b2fda17-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 22:28:48,419 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-13 22:28:48,420 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 22:28:48,421 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 22:28:48,421 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 22:28:48,421 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 22:28:48,421 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 14 Jul 2025 02:28:48 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '4312'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '4316'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9997'), ('x-ratelimit-remaining-tokens', '9244'), ('x-ratelimit-reset-requests', '20.683s'), ('x-ratelimit-reset-tokens', '4.536s'), ('x-request-id', 'req_b9599249139079c75dd150887049c5d3'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=KG0H33fYAE3qofy3oN77HA93z3m3ya5rbSNddy8B8jY-1752460128-1.0.1.1-goGX9WrlvgW2LdrL77J_3tIS7iTjWxx9nT5gQ4s4F2iI91PjoV2wjEfszLIxtyNmAQx13_S7ajA0dg4fCMJWGinHrjd37yt6fHZTgZeNDt4; path=/; expires=Mon, 14-Jul-25 02:58:48 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=.riM7q1Xo1dNTlYOkiHrkD0Yc6tuR3QFIJpmoXVe8Ug-1752460128696-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95ed969e1b2fda17-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-13 22:28:48,422 - openai._base_client - DEBUG - request_id: req_b9599249139079c75dd150887049c5d3
2025-07-13 22:28:48,440 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-13T22:28:48.440932",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1003,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "explain to me what this report does"
}
2025-07-13 22:28:48,446 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-13T22:28:48.442947",
  "user_question": "explain to me what this report does",
  "ai_response": "I apologize for any confusion, but it seems there's a misunderstanding. The information provided earlier is about the data schema context of a BSEG table from an SAP ECC system, which contains line item data for accounting documents. It does not represent a specific report.\n\nHowever, if you were to create a report using this table, it could provide insights into various financial transactions. For instance, you could analyze the debit and credit amounts for different general ledger accounts, track transactions by company code or fiscal year, or examine transactions related to specific vendors or customers. \n\nThe report could also help identify potential data quality issues, as the table reportedly has about 67.59% null values. This could indicate missing or incomplete data that might need to be addressed to ensure accurate financial reporting and compliance.\n\nIf you have a specific question or report requirement related to this data, please provide more details so I can assist you better.",
  "processing_time_seconds": 6.466715574264526,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-13 22:28:48,566 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:28:48] "POST / HTTP/1.1" 200 -
2025-07-13 22:30:51,142 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:30:51,610 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:30:55,096 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:30:56,235 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:30:56,890 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:30:57,305 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:30:57,732 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:31:02,787 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:31:02,832 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:31:06,997 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:31:07,069 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:31:08,190 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:31:08,245 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:31:42,239 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-13 22:31:42,240 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-13 22:31:42,246 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:31:46,243 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:31:46] "GET / HTTP/1.1" 200 -
2025-07-13 22:31:48,513 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:31:48,543 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:31:54,307 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-13 22:31:54,312 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 22:31:54,321 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T22:31:54.321287",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": "0.0"
  }
}
2025-07-13 22:31:54,325 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:31:54] "POST /upload HTTP/1.1" 200 -
2025-07-13 22:31:54,525 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:31:54] "GET / HTTP/1.1" 200 -
2025-07-13 22:31:59,096 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 22:31:59,102 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-13 22:31:59,106 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-13 22:32:00,591 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-128af1ac-1d55-44a0-917e-7a0e432f5413', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'explain to me what this report does'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 22:32:00,596 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 22:32:00,597 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 22:32:00,665 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000179E441A0D0>
2025-07-13 22:32:00,666 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000179E3856740> server_hostname='api.openai.com' timeout=5.0
2025-07-13 22:32:00,697 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000179E4420D00>
2025-07-13 22:32:00,697 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 22:32:00,698 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 22:32:00,698 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 22:32:00,700 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 22:32:00,700 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 22:32:05,641 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 02:32:05 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'4625'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4628'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9244'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'4.536s'), (b'x-request-id', b'req_c4d83d3704581ccc34a817a71c5495d7'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=cXVoUVh_Jp4UAImKxYZDgwbNJlQ0urQQp2xFoVtrbPk-1752460325-1.0.1.1-XrK2OZgWXlzSZ34puHQLjJDqiZQWPGt6Je5FLahtMzVdmITzCRgRtfYa1UU8McDD7Khx0NljkbrD0_jKwHwZgGv8BT5LqQHH.R2ghnJj8us; path=/; expires=Mon, 14-Jul-25 03:02:05 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=0mHEdC6_.MdaOHonG8Otsw1JlqdkEyAk45x_9a0_aRU-1752460325922-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95ed9b6e3ccdda04-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 22:32:05,643 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-13 22:32:05,645 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 22:32:05,647 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 22:32:05,648 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 22:32:05,648 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 22:32:05,648 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 14 Jul 2025 02:32:05 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '4625'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '4628'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9244'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '4.536s'), ('x-request-id', 'req_c4d83d3704581ccc34a817a71c5495d7'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=cXVoUVh_Jp4UAImKxYZDgwbNJlQ0urQQp2xFoVtrbPk-1752460325-1.0.1.1-XrK2OZgWXlzSZ34puHQLjJDqiZQWPGt6Je5FLahtMzVdmITzCRgRtfYa1UU8McDD7Khx0NljkbrD0_jKwHwZgGv8BT5LqQHH.R2ghnJj8us; path=/; expires=Mon, 14-Jul-25 03:02:05 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=0mHEdC6_.MdaOHonG8Otsw1JlqdkEyAk45x_9a0_aRU-1752460325922-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95ed9b6e3ccdda04-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-13 22:32:05,648 - openai._base_client - DEBUG - request_id: req_c4d83d3704581ccc34a817a71c5495d7
2025-07-13 22:32:05,669 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-13T22:32:05.669956",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 768,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "explain to me what this report does"
}
2025-07-13 22:32:05,682 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-13T22:32:05.675775",
  "user_question": "explain to me what this report does",
  "ai_response": "I'm sorry, but I can't provide insights or recommendations without specific query results or a detailed description of the report. The information you provided only describes the schema of the BSEG table, which contains line item data for accounting documents. This includes information such as the company code, document number, fiscal year, general ledger account, debit or credit indicator, local amount, document amount, vendor number, and customer number.\n\nIf you could provide more details about the report or the specific query results, I would be able to provide more targeted insights and recommendations. For example, are you looking for information about specific transactions, trends over time, comparisons between different accounts or fiscal years, etc.?",
  "processing_time_seconds": 6.59519100189209,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-13 22:32:05,858 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:32:05] "POST / HTTP/1.1" 200 -
2025-07-13 22:32:06,118 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:32:06] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-13 22:34:28,504 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:34:29,121 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:34:32,731 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:34:33,528 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:34:33,820 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:34:33,941 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:34:34,245 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:34:34,392 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:34:40,242 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:34:40,296 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:34:42,761 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:34:42,809 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:34:43,379 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:34:43,445 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:34:43,708 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:34:43,760 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:34:55,406 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:34:55,776 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:34:57,315 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:34:57,712 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:35:02,302 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:35:02,680 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:35:02,742 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:35:03,138 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:35:06,477 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:35:06,555 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:35:09,100 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:35:09,170 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:35:12,937 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:35:12,992 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:35:13,375 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:35:13,466 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:36:42,927 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\debug_full_pipeline.py', reloading
2025-07-13 22:36:42,942 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\debug_full_pipeline.py', reloading
2025-07-13 22:36:43,335 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:36:43,342 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:36:43,391 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\debug_full_pipeline.py', reloading
2025-07-13 22:36:43,870 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:36:45,516 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\debug_full_pipeline.py', reloading
2025-07-13 22:36:45,910 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:36:52,345 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:36:52,388 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:36:52,414 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:36:52,456 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:36:52,859 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:36:52,908 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:36:54,104 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:36:54,153 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:37:23,790 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:37:24,248 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:37:24,389 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:37:24,843 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:37:25,174 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:37:25,608 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:37:26,484 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-13 22:37:27,059 - werkzeug - INFO -  * Restarting with stat
2025-07-13 22:37:31,597 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:37:31,627 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:37:32,029 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:37:32,086 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:37:32,294 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:37:32,326 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:37:33,416 - werkzeug - WARNING -  * Debugger is active!
2025-07-13 22:37:33,439 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-13 22:39:35,182 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:39:35] "GET / HTTP/1.1" 200 -
2025-07-13 22:39:40,756 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-13 22:39:40,759 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 22:39:40,761 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T22:39:40.761062",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": "0.0"
  }
}
2025-07-13 22:39:40,763 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:39:40] "POST /upload HTTP/1.1" 200 -
2025-07-13 22:39:40,910 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:39:40] "GET / HTTP/1.1" 200 -
2025-07-13 22:39:48,316 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 22:39:48,321 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-13 22:39:48,328 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-13 22:39:49,599 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-a19d0fe9-ba85-42ca-a0a3-3ddc82b96a7d', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'explain to me what this report does'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 22:39:49,604 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 22:39:49,605 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 22:39:49,677 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000015B12F0BD60>
2025-07-13 22:39:49,678 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000015B12DD71C0> server_hostname='api.openai.com' timeout=5.0
2025-07-13 22:39:49,705 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000015B12F0BBB0>
2025-07-13 22:39:49,705 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 22:39:49,706 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 22:39:49,706 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 22:39:49,707 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 22:39:49,707 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 22:40:00,455 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 02:40:00 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'10557'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'10563'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9244'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'4.536s'), (b'x-request-id', b'req_028a739223783d7277742fda2a58959f'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=LqbD8fIWSdGmofhiW1ZP.abjiRm.6yY31FVCBZdXU40-1752460800-1.0.1.1-NpE4E1UbUVwdXU_W_XaJpqnqNpAfSZ0tVAEB4qDfLrm1CP8_Qe0MHi.1BLA3NFrTpaOdaZ.LriQVEY6M1iudKI672IEZ8kuJyKFgOECmJtk; path=/; expires=Mon, 14-Jul-25 03:10:00 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=vnzMAoauvRAM2N2.0zEt1quVAsCHnIe7jd2g8Hj0iN0-1752460800740-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95eda6e188fd3714-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 22:40:00,458 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-13 22:40:00,460 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 22:40:00,461 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 22:40:00,461 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 22:40:00,461 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 22:40:00,462 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 14 Jul 2025 02:40:00 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '10557'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '10563'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9244'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '4.536s'), ('x-request-id', 'req_028a739223783d7277742fda2a58959f'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=LqbD8fIWSdGmofhiW1ZP.abjiRm.6yY31FVCBZdXU40-1752460800-1.0.1.1-NpE4E1UbUVwdXU_W_XaJpqnqNpAfSZ0tVAEB4qDfLrm1CP8_Qe0MHi.1BLA3NFrTpaOdaZ.LriQVEY6M1iudKI672IEZ8kuJyKFgOECmJtk; path=/; expires=Mon, 14-Jul-25 03:10:00 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=vnzMAoauvRAM2N2.0zEt1quVAsCHnIe7jd2g8Hj0iN0-1752460800740-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95eda6e188fd3714-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-13 22:40:00,462 - openai._base_client - DEBUG - request_id: req_028a739223783d7277742fda2a58959f
2025-07-13 22:40:00,481 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-13T22:40:00.480697",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1390,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "explain to me what this report does"
}
2025-07-13 22:40:00,489 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-13T22:40:00.484438",
  "user_question": "explain to me what this report does",
  "ai_response": "I'm sorry, but I can't provide insights or recommendations based on the provided information. It appears there was a misunderstanding, as no specific report or query results have been provided. \n\nHowever, I can explain what the BSEG table in SAP ECC is used for. The BSEG table is an Accounting Document Segment table. It contains line items for accounting documents, including account assignments, amounts, posting keys, and vendor/customer references. \n\nKey columns in the BSEG table include:\n\n- BUKRS: The company code. This is a 4-digit code representing a legal entity or government department.\n- BELNR: The document number. This is a unique identifier for each accounting document.\n- GJAHR: The fiscal year. This is important for government reporting.\n- KONTO: The general ledger (G/L) account. This is the account to which the line item is posted.\n- SHKZG: The debit/credit indicator. This indicates whether the line item is a debit or credit.\n- DMBTR: The local amount. This is the amount of the line item in the local currency.\n- WRBTR: The document amount. This is the amount of the line item in the document currency.\n- LIFNR: The vendor number. This is a unique identifier for each vendor.\n- KUNNR: The customer number. This is a unique identifier for each customer.\n\nIf you have a specific report or query results that you would like me to analyze, please provide more details.",
  "processing_time_seconds": 12.188474178314209,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-13 22:40:00,584 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:40:00] "POST / HTTP/1.1" 200 -
2025-07-13 22:40:54,610 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:40:54] "GET / HTTP/1.1" 200 -
2025-07-13 22:41:12,666 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:41:12] "GET / HTTP/1.1" 200 -
2025-07-13 22:43:08,076 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-13 22:43:08,081 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-13 22:43:08,086 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-13T22:43:08.085675",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": "0.0"
  }
}
2025-07-13 22:43:08,090 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:43:08] "POST /upload HTTP/1.1" 200 -
2025-07-13 22:43:08,329 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:43:08] "GET / HTTP/1.1" 200 -
2025-07-13 22:43:19,416 - query_executor - INFO - Dataframe preprocessing completed
2025-07-13 22:43:19,428 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-a12741f9-e6df-4a7f-a174-739a676872ce', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'explain to me what this report does'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-13 22:43:19,435 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-13 22:43:19,437 - httpcore.connection - DEBUG - close.started
2025-07-13 22:43:19,438 - httpcore.connection - DEBUG - close.complete
2025-07-13 22:43:19,438 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-13 22:43:19,470 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000015B13587520>
2025-07-13 22:43:19,471 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000015B12DD71C0> server_hostname='api.openai.com' timeout=5.0
2025-07-13 22:43:19,493 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000015B13587250>
2025-07-13 22:43:19,493 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-13 22:43:19,495 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-13 22:43:19,495 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-13 22:43:19,496 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-13 22:43:19,497 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-13 22:43:32,907 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 02:43:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'13269'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'13276'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9244'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'4.536s'), (b'x-request-id', b'req_c623d1a38d0705771d90dba6aa713402'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95edac00ba4c1f08-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-13 22:43:32,908 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-13 22:43:32,909 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-13 22:43:32,910 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-13 22:43:32,910 - httpcore.http11 - DEBUG - response_closed.started
2025-07-13 22:43:32,910 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-13 22:43:32,911 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 14 Jul 2025 02:43:33 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-skjlilaq40lpll1nj6yydmay', 'openai-processing-ms': '13269', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '13276', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9244', 'x-ratelimit-reset-requests': '8.64s', 'x-ratelimit-reset-tokens': '4.536s', 'x-request-id': 'req_c623d1a38d0705771d90dba6aa713402', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '95edac00ba4c1f08-MIA', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-07-13 22:43:32,911 - openai._base_client - DEBUG - request_id: req_c623d1a38d0705771d90dba6aa713402
2025-07-13 22:43:32,912 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-13T22:43:32.912130",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1633,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "explain to me what this report does"
}
2025-07-13 22:43:32,920 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-13T22:43:32.916523",
  "user_question": "explain to me what this report does",
  "ai_response": "I'm sorry, but it seems there's been a misunderstanding. The information provided is not a report but rather a context of a data schema from the BSEG (Accounting Document Segment) table in SAP ECC. This table is used to store line items data related to financial transactions.\n\nHere's a brief explanation of the key columns available in this context:\n\n1. BUKRS (Company Code): This represents the legal entity or government department that the financial transaction belongs to.\n2. BELNR (Document Number): This is the unique identifier of a financial document.\n3. GJAHR (Fiscal Year): This represents the fiscal year in which the financial transaction occurred.\n4. KONTO (GL Account): This is the general ledger account that the transaction is posted to.\n5. SHKZG (Debit Credit Indicator): This indicates whether the line item is a debit or a credit.\n6. DMBTR (Local Amount): This is the transaction amount in the local currency.\n7. WRBTR (Document Amount): This is the transaction amount in the document currency.\n8. LIFNR (Vendor Number): This is the unique identifier of the vendor involved in the transaction.\n9. KUNNR (Customer Number): This is the unique identifier of the customer involved in the transaction.\n\nThe data schema context also mentions that the data quality is at 67.59% due to null values. This indicates that a significant portion of the data in the table is missing or not recorded. This could potentially impact the accuracy of any reports or analyses derived from this data.\n\nPlease provide more specific details or questions about the data or the type of report you need, and I'll be glad to assist further.",
  "processing_time_seconds": 13.50968337059021,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-13 22:43:33,032 - werkzeug - INFO - 127.0.0.1 - - [13/Jul/2025 22:43:33] "POST / HTTP/1.1" 200 -
2025-07-14 07:28:17,676 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 07:28:18,557 - werkzeug - INFO -  * Restarting with stat
2025-07-14 07:28:19,554 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 07:28:20,066 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 07:28:20,263 - werkzeug - INFO -  * Restarting with stat
2025-07-14 07:28:20,808 - werkzeug - INFO -  * Restarting with stat
2025-07-14 07:28:21,706 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 07:28:22,367 - werkzeug - INFO -  * Restarting with stat
2025-07-14 07:28:46,251 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 07:28:46,255 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 07:28:46,255 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 07:28:46,303 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 07:28:46,308 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 07:28:46,312 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 07:28:46,312 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:39:14,787 - werkzeug - INFO - 127.0.0.1 - - [14/Jul/2025 19:39:14] "POST / HTTP/1.1" 200 -
2025-07-14 19:39:55,430 - werkzeug - INFO - 127.0.0.1 - - [14/Jul/2025 19:39:55] "GET / HTTP/1.1" 200 -
2025-07-14 19:40:13,172 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-14 19:40:13,174 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-14 19:40:13,190 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:40:19,224 - werkzeug - INFO - 127.0.0.1 - - [14/Jul/2025 19:40:19] "GET / HTTP/1.1" 200 -
2025-07-14 19:40:21,865 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:40:21,941 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:40:29,711 - schema_analyzer - INFO - Schema analysis completed for uploads\f1e0acd6-8c23-4106-90ca-03894c763f3c_sample_bseg.csv
2025-07-14 19:40:29,729 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-14 19:40:29,745 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-14T19:40:29.744187",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "f1e0acd6-8c23-4106-90ca-03894c763f3c",
    "file_size_mb": "0.0"
  }
}
2025-07-14 19:40:29,807 - werkzeug - INFO - 127.0.0.1 - - [14/Jul/2025 19:40:29] "POST /upload HTTP/1.1" 200 -
2025-07-14 19:40:30,009 - werkzeug - INFO - 127.0.0.1 - - [14/Jul/2025 19:40:30] "GET / HTTP/1.1" 200 -
2025-07-14 19:40:53,569 - query_executor - INFO - Dataframe preprocessing completed
2025-07-14 19:40:53,656 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-14 19:40:53,749 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-14 19:40:58,910 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-16994f5f-45b4-467b-bfb9-4f1eab241fa9', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'What does this report do and how should I use it if I work for the Navy?'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-14 19:40:58,916 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-14 19:40:58,918 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-14 19:40:59,027 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013750DBC520>
2025-07-14 19:40:59,027 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000137507CF6C0> server_hostname='api.openai.com' timeout=5.0
2025-07-14 19:40:59,059 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013750DBC370>
2025-07-14 19:40:59,060 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-14 19:40:59,062 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-14 19:40:59,062 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-14 19:40:59,064 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-14 19:40:59,064 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-14 19:41:09,195 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 14 Jul 2025 23:41:09 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'9611'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'9618'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9235'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'4.59s'), (b'x-request-id', b'req_85b2b451d9405aa19e2cb10a8e56fef5'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=XIsFY3ISlvtp3OmhjUq_pIk2o_R4zCzE2hRv6pfspIY-1752536469-1.0.1.1-5amQiexfS1hy0B6u0RFD.gBWvBwUZRgz_PLw.A8W2HUk0mygkcrh3GvpexS4FkWvOzCO1Qdc8MOBr7reZ5CQbMnQaSUTt4mFEKYJRp1fApw; path=/; expires=Tue, 15-Jul-25 00:11:09 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=gYYtfCztMFx4x4sw.AfVFk4I0WvBmoJWd0UF5fFzBO0-1752536469045-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95f4de444a077481-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-14 19:41:09,204 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-14 19:41:09,207 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-14 19:41:09,210 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-14 19:41:09,210 - httpcore.http11 - DEBUG - response_closed.started
2025-07-14 19:41:09,211 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-14 19:41:09,211 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 14 Jul 2025 23:41:09 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '9611'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '9618'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9235'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '4.59s'), ('x-request-id', 'req_85b2b451d9405aa19e2cb10a8e56fef5'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=XIsFY3ISlvtp3OmhjUq_pIk2o_R4zCzE2hRv6pfspIY-1752536469-1.0.1.1-5amQiexfS1hy0B6u0RFD.gBWvBwUZRgz_PLw.A8W2HUk0mygkcrh3GvpexS4FkWvOzCO1Qdc8MOBr7reZ5CQbMnQaSUTt4mFEKYJRp1fApw; path=/; expires=Tue, 15-Jul-25 00:11:09 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=gYYtfCztMFx4x4sw.AfVFk4I0WvBmoJWd0UF5fFzBO0-1752536469045-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95f4de444a077481-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-14 19:41:09,212 - openai._base_client - DEBUG - request_id: req_85b2b451d9405aa19e2cb10a8e56fef5
2025-07-14 19:41:09,234 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-14T19:41:09.234952",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1926,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails\n- Highlight compliance with government accounting standards\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n\nAlways provide professional, accurate, and compliance-aware responses suitable for government and enterprise environments.",
  "user_message": "What does this report do and how should I use it if I work for the Navy?"
}
2025-07-14 19:41:09,243 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-14T19:41:09.236953",
  "user_question": "What does this report do and how should I use it if I work for the Navy?",
  "ai_response": "As an SAP ECC financial data analyst assistant, I can help you understand the data in the BSEG table, which is a part of the SAP financial system. This table contains line item data for accounting documents, including information about company codes, document numbers, fiscal years, GL accounts, debit or credit indicators, local amounts, document amounts, vendor numbers, and customer numbers.\n\nIf you work for the Navy, this data can be very useful for a variety of purposes. Here are a few examples:\n\n1. Budget Management: You can use the data to track spending and manage your budget. For example, you can analyze the local_amount (DMBTR) and document_amount (WRBTR) fields to understand how much money has been spent or received.\n\n2. Vendor Management: The vendor_number (LIFNR) field can help you manage your relationships with vendors. For example, you can identify which vendors you are spending the most with and negotiate better terms.\n\n3. Financial Reporting: You can use the data to generate financial reports. For example, you can analyze the data by fiscal_year (GJAHR) to understand your financial performance in a specific year.\n\n4. Audit and Compliance: The data in the BSEG table can be used for audit trails and to ensure compliance with government accounting standards. For example, you can use the debit_credit_indicator (SHKZG) field to verify that all transactions have been correctly recorded as either debits or credits.\n\nPlease note that the data quality of this table is currently at 67.59%, indicating a significant number of null values. This could potentially impact the accuracy of your analysis and reporting, so it's important to address these data quality issues.\n\nAs a government entity, the Navy must also ensure that it is in compliance with various regulations and standards. Therefore, it's important to use this data responsibly and in accordance with all relevant laws and regulations.",
  "processing_time_seconds": 15.686445713043213,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-14 19:41:09,402 - werkzeug - INFO - 127.0.0.1 - - [14/Jul/2025 19:41:09] "POST / HTTP/1.1" 200 -
2025-07-14 19:45:11,961 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\prompt_templates.py', reloading
2025-07-14 19:45:12,547 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:14,048 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\prompt_templates.py', reloading
2025-07-14 19:45:14,886 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\prompt_templates.py', reloading
2025-07-14 19:45:15,728 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:16,304 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\prompt_templates.py', reloading
2025-07-14 19:45:16,339 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:17,628 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:19,419 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\prompt_templates.py', reloading
2025-07-14 19:45:19,973 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:27,604 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:45:27,905 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:45:28,534 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:45:28,605 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:45:30,456 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:45:30,887 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:45:31,520 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:45:31,674 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:45:34,034 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:45:34,100 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:45:49,900 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:45:50,517 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:51,136 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:45:52,036 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:53,174 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:45:53,922 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:56,224 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:45:56,902 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:45:59,229 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:45:59,720 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:46:04,566 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:46:04,640 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:46:06,193 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:46:06,300 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:46:08,106 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:46:08,262 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:46:12,232 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:46:12,304 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:46:13,456 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:46:13,539 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:47:51,826 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:47:51,946 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:47:52,323 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:47:52,614 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:47:54,794 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:47:55,024 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:47:55,388 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:47:55,480 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:47:55,602 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:47:56,372 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:48:07,154 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:07,206 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:07,899 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:07,988 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:09,466 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:09,536 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:10,070 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:10,115 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:10,335 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:10,384 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:38,400 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-14 19:48:38,788 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:48:38,952 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-14 19:48:39,400 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:48:40,640 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-14 19:48:41,207 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-14 19:48:41,268 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:48:41,673 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:48:41,717 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-14 19:48:42,688 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:48:49,846 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:49,896 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:50,687 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:50,763 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:51,933 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:52,020 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:53,247 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:53,356 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:48:53,533 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:48:53,574 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:49:35,805 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:49:36,205 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:49:36,396 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:49:36,509 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:49:36,840 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:49:37,664 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:49:40,987 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:49:41,763 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-14 19:49:41,788 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:49:42,590 - werkzeug - INFO -  * Restarting with stat
2025-07-14 19:49:55,532 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:49:55,634 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:49:55,989 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:49:56,157 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:49:56,881 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:49:57,212 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:50:00,924 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:50:00,987 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-14 19:50:01,504 - werkzeug - WARNING -  * Debugger is active!
2025-07-14 19:50:01,555 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:31:04,672 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 17:31:04,672 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 17:31:04,674 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:31:07,437 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:31:07,466 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:31:32,890 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 17:31:32] "GET / HTTP/1.1" 200 -
2025-07-15 17:31:32,997 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 17:31:32] "GET /static/its_consulting_logo_small.png HTTP/1.1" 200 -
2025-07-15 17:31:32,997 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 17:31:32] "GET /static/its_consulting_logo_transparent.png HTTP/1.1" 200 -
2025-07-15 17:31:33,044 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 17:31:33] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-15 17:33:57,364 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:33:57] "GET / HTTP/1.1" 200 -
2025-07-15 17:33:57,443 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:33:57] "GET /static/its_consulting_logo_transparent.png HTTP/1.1" 200 -
2025-07-15 17:33:57,581 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:33:57] "GET /static/its_consulting_logo_small.png HTTP/1.1" 200 -
2025-07-15 17:33:57,980 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:33:57] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-15 17:38:10,310 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 17:38:10,669 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:38:18,423 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:38:18,452 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:38:53,856 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:38:53] "GET / HTTP/1.1" 200 -
2025-07-15 17:38:53,905 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:38:53] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:38:54,077 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:38:54] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:39:05,689 - schema_analyzer - INFO - Schema analysis completed for uploads\2e8ed402-2c98-413a-8048-72fc98438d6e_sample_bseg.csv
2025-07-15 17:39:05,691 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 17:39:05,692 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T17:39:05.692156",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "2e8ed402-2c98-413a-8048-72fc98438d6e",
    "file_size_mb": "0.0"
  }
}
2025-07-15 17:39:05,696 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:05] "POST /upload HTTP/1.1" 200 -
2025-07-15 17:39:05,901 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:05] "GET / HTTP/1.1" 200 -
2025-07-15 17:39:06,050 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:06] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:39:06,250 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:06] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:39:17,571 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 17:39:17,603 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-15 17:39:17,605 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-15 17:39:17,610 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-15 17:39:19,093 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-347795f4-d576-4c04-87b4-2f068600cf44', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'Analyze posting key patterns and anomalies'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 30\n- Execution time: 0.00 seconds\n- Data summary: {'total_rows': 30, 'total_columns': 29, 'column_stats': {'BUKRS': {'min': 1000.0, 'max': 1000.0, 'mean': 1000.0, 'sum': 30000.0}, 'BELNR': {'min': 1000000001.0, 'max': 1000000015.0, 'mean': 1000000008.0, 'sum': 30000000240.0}, 'GJAHR': {'min': 2024.0, 'max': 2024.0, 'mean': 2024.0, 'sum': 60720.0}, 'BUZEI': {'min': 1.0, 'max': 2.0, 'mean': 1.5, 'sum': 45.0}, 'KONTO': {'min': 100000.0, 'max': 600000.0, 'mean': 240666.66666666666, 'sum': 7220000.0}, 'SHKZG': {'unique_values': 1, 'top_values': {'S': 15, 'H': 15}}, 'DMBTR': {'min': 800.0, 'max': 7500.0, 'mean': 3346.6666666666665, 'sum': 100400.0}, 'WRBTR': {'min': 800.0, 'max': 7500.0, 'mean': 3346.6666666666665, 'sum': 100400.0}}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 17:39:19,098 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 17:39:19,098 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 17:39:19,134 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002465FD86400>
2025-07-15 17:39:19,134 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002465FB3A640> server_hostname='api.openai.com' timeout=5.0
2025-07-15 17:39:19,160 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002465FD86250>
2025-07-15 17:39:19,160 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 17:39:19,161 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 17:39:19,161 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 17:39:19,162 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 17:39:19,162 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 17:39:37,560 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 21:39:37 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'17823'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'17826'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8783'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'7.302s'), (b'x-request-id', b'req_285e22b7346854336fe337d2c32faddd'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=FxfJvi.kVkr7XHvzCcXFqSldN.AX1Ms.ykja0HaGSPc-1752615577-1.0.1.1-0FklA81TiAOu9aCmYrUTLHxNL00EWXLjKM7.J2vZTL77Oa7KwKPkI06.exdPuJdFXZy7IFEwTrds9_mrIaC6Gl0CHT.L_419G_ESmxCaqm0; path=/; expires=Tue, 15-Jul-25 22:09:37 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=8WTXR60IwyjSsR4E7xI8IsJOh_vqIRa.02_6hUyQN38-1752615577179-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fc696a9c1d31fb-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 17:39:37,563 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 17:39:37,564 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 17:39:37,571 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 17:39:37,572 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 17:39:37,572 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 17:39:37,574 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 15 Jul 2025 21:39:37 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '17823'), ('openai-project', 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '17826'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '8783'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '7.302s'), ('x-request-id', 'req_285e22b7346854336fe337d2c32faddd'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=FxfJvi.kVkr7XHvzCcXFqSldN.AX1Ms.ykja0HaGSPc-1752615577-1.0.1.1-0FklA81TiAOu9aCmYrUTLHxNL00EWXLjKM7.J2vZTL77Oa7KwKPkI06.exdPuJdFXZy7IFEwTrds9_mrIaC6Gl0CHT.L_419G_ESmxCaqm0; path=/; expires=Tue, 15-Jul-25 22:09:37 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=8WTXR60IwyjSsR4E7xI8IsJOh_vqIRa.02_6hUyQN38-1752615577179-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95fc696a9c1d31fb-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-15 17:39:37,575 - openai._base_client - DEBUG - request_id: req_285e22b7346854336fe337d2c32faddd
2025-07-15 17:39:37,607 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T17:39:37.607475",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 2483,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "Analyze posting key patterns and anomalies"
}
2025-07-15 17:39:37,639 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T17:39:37.623224",
  "user_question": "Analyze posting key patterns and anomalies",
  "ai_response": "Based on the query execution results, we have 30 rows of data with 29 columns. The company code (BUKRS) is consistently 1000 across all records, which indicates that all transactions belong to the same organizational entity within the Navy.\n\nThe document numbers (BELNR) range from 1000000001 to 1000000015, suggesting that we have multiple line items for some documents. This could be due to different cost centers, G/L accounts, or vendors/customers involved in the same transaction.\n\nThe fiscal year (GJAHR) is consistently 2024, meaning all transactions occurred in the same fiscal year. This is important for annual financial reporting and audit purposes.\n\nThe G/L accounts (KONTO) range from 100000 to 600000, indicating that a variety of different financial activities are represented in the data. The Navy should ensure that these G/L accounts are correctly mapped to the appropriate budget categories and appropriation types.\n\nThe debit/credit indicator (SHKZG) shows an equal number of 'S' (debit) and 'H' (credit) entries. This is a good sign as it suggests that all transactions are balanced, which is a fundamental requirement in double-entry bookkeeping.\n\nThe local and document amounts (DMBTR and WRBTR) range from 800 to 7500, with an average of 3346.67. If these amounts are significantly different from expected values, it could indicate potential errors or anomalies that need further investigation.\n\nGiven the high percentage of null values (67.59%), the Navy should review its data entry processes and controls to improve data quality. Missing or incorrect data can lead to inaccurate financial reporting and compliance issues.\n\nIn terms of posting key patterns, the equal distribution of debit and credit entries is a positive sign. However, the Navy should also analyze the distribution of posting keys across different G/L accounts, document types, and vendors/customers to identify any unusual patterns or potential risks. For example, a high number of credit entries for a specific vendor could indicate potential overpayments or fraud.\n\nIn conclusion, while the data shows some positive signs in terms of transaction balancing and variety of financial activities, there are areas for improvement in data quality and potential risks that need further investigation. The Navy should consider implementing additional data quality checks and controls, as well as conducting regular data audits to ensure compliance with DoD financial regulations and standards.",
  "processing_time_seconds": 20.05996823310852,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-15 17:39:38,091 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:38] "POST / HTTP/1.1" 200 -
2025-07-15 17:39:38,204 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:38] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:39:38,512 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:39:38] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:47:42,400 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 17:47:42,883 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:47:49,181 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:47:49,209 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:47:59,369 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 17:47:59,686 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:48:05,289 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:48:05,327 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:48:14,224 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 17:48:14,400 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:48:19,430 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:48:19,451 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:48:34,268 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 17:48:34,456 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:48:42,282 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:48:42,301 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:49:12,008 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:49:12] "GET / HTTP/1.1" 200 -
2025-07-15 17:49:12,065 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:49:12] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:49:12,227 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:49:12] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:49:21,739 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:49:21] "GET / HTTP/1.1" 200 -
2025-07-15 17:49:21,775 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:49:21] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:49:21,946 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:49:21] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:50:12,792 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 17:50:13,035 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:50:19,645 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:50:19,673 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:50:21,900 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:21] "GET / HTTP/1.1" 200 -
2025-07-15 17:50:21,969 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:21] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:50:21,974 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:21] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:50:26,718 - schema_analyzer - INFO - Schema analysis completed for uploads\2e8ed402-2c98-413a-8048-72fc98438d6e_sample_bseg.csv
2025-07-15 17:50:26,720 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 17:50:26,722 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T17:50:26.722787",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "2e8ed402-2c98-413a-8048-72fc98438d6e",
    "file_size_mb": "0.0"
  }
}
2025-07-15 17:50:26,725 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:26] "POST /upload HTTP/1.1" 200 -
2025-07-15 17:50:26,960 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:26] "GET / HTTP/1.1" 200 -
2025-07-15 17:50:27,089 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:27] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:50:27,324 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:27] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:50:34,365 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 17:50:34,386 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-15 17:50:34,388 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-15 17:50:34,391 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-15 17:50:35,465 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-63735389-c748-4d8e-90d3-dbaf24ccb689', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'Analyze budget vs actual spending by cost center'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 30\n- Execution time: 0.00 seconds\n- Data summary: {'total_rows': 30, 'total_columns': 29, 'column_stats': {'BUKRS': {'min': 1000.0, 'max': 1000.0, 'mean': 1000.0, 'sum': 30000.0}, 'BELNR': {'min': 1000000001.0, 'max': 1000000015.0, 'mean': 1000000008.0, 'sum': 30000000240.0}, 'GJAHR': {'min': 2024.0, 'max': 2024.0, 'mean': 2024.0, 'sum': 60720.0}, 'BUZEI': {'min': 1.0, 'max': 2.0, 'mean': 1.5, 'sum': 45.0}, 'KONTO': {'min': 100000.0, 'max': 600000.0, 'mean': 240666.66666666666, 'sum': 7220000.0}, 'SHKZG': {'unique_values': 1, 'top_values': {'S': 15, 'H': 15}}, 'DMBTR': {'min': 800.0, 'max': 7500.0, 'mean': 3346.6666666666665, 'sum': 100400.0}, 'WRBTR': {'min': 800.0, 'max': 7500.0, 'mean': 3346.6666666666665, 'sum': 100400.0}}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 17:50:35,468 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 17:50:35,470 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 17:50:35,507 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000014093129640>
2025-07-15 17:50:35,508 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000014092CA0BC0> server_hostname='api.openai.com' timeout=5.0
2025-07-15 17:50:35,527 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000014093129400>
2025-07-15 17:50:35,527 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 17:50:35,527 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 17:50:35,528 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 17:50:35,528 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 17:50:35,528 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 17:50:50,817 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 21:50:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'14921'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'14924'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8781'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'7.314s'), (b'x-request-id', b'req_87bca23a19cce2c409a96f5a38049ad7'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=VMc6rA.b3w9BlEJetHdPaDgdSeAjKm3CWLLfeoxe5JY-1752616250-1.0.1.1-Kp3DAcyAabvm_q93g5RRCe..gdpH7OvuXIbqeK2nY2fChzdjKMQ7WKbr_Zr8A5dVfAmCTT.T57XVGAxw7f.6WufqExVuUeNwfNKQYk3px78; path=/; expires=Tue, 15-Jul-25 22:20:50 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=BuOsrDkdksKJehA8Z5Ae9Y6UrJiHNomOlMNNGHr.dsk-1752616250447-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fc79eddd8c8f0e-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 17:50:50,819 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 17:50:50,820 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 17:50:50,820 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 17:50:50,820 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 17:50:50,822 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 17:50:50,822 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 15 Jul 2025 21:50:50 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '14921'), ('openai-project', 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '14924'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '8781'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '7.314s'), ('x-request-id', 'req_87bca23a19cce2c409a96f5a38049ad7'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=VMc6rA.b3w9BlEJetHdPaDgdSeAjKm3CWLLfeoxe5JY-1752616250-1.0.1.1-Kp3DAcyAabvm_q93g5RRCe..gdpH7OvuXIbqeK2nY2fChzdjKMQ7WKbr_Zr8A5dVfAmCTT.T57XVGAxw7f.6WufqExVuUeNwfNKQYk3px78; path=/; expires=Tue, 15-Jul-25 22:20:50 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=BuOsrDkdksKJehA8Z5Ae9Y6UrJiHNomOlMNNGHr.dsk-1752616250447-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95fc79eddd8c8f0e-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-15 17:50:50,822 - openai._base_client - DEBUG - request_id: req_87bca23a19cce2c409a96f5a38049ad7
2025-07-15 17:50:50,834 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T17:50:50.834473",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1736,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "Analyze budget vs actual spending by cost center"
}
2025-07-15 17:50:50,838 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T17:50:50.835469",
  "user_question": "Analyze budget vs actual spending by cost center",
  "ai_response": "Based on the query execution results, we have 30 records from the BSEG table for company code 1000 in the fiscal year 2024. The document numbers range from 1000000001 to 1000000015, indicating that there are multiple line items per document.\n\nThe G/L accounts involved range from 100000 to 600000. The debit and credit indicators show an equal number of 'S' (debit) and 'H' (credit) entries, indicating a balanced set of transactions. \n\nThe local and document amounts range from 800 to 7500 with an average of approximately 3346.67. The total amount for these transactions is 100400.\n\nTo analyze budget vs actual spending by cost center, we would need additional data. Specifically, we would need budget data for each cost center, which could be stored in a separate table or as part of the master data for each cost center. We would also need the cost center assignment for each line item in the BSEG table. \n\nOnce we have this data, we can compare the total actual spending (sum of DMBTR for each cost center) against the budget for each cost center. This will allow us to identify any cost centers that are over or under budget.\n\nIn terms of recommendations, it's important to regularly monitor actual spending against budget at the cost center level. This can help identify any areas of overspending early and allow for corrective action to be taken. It can also highlight areas where spending is lower than expected, which could indicate under-utilization of resources or potential savings.\n\nPlease note that due to the high percentage of null values (67.59%) in the dataset, the accuracy of this analysis may be impacted. It would be beneficial to investigate the cause of these null values and take steps to improve data quality.",
  "processing_time_seconds": 16.478139638900757,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-15 17:50:50,962 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:50] "POST / HTTP/1.1" 200 -
2025-07-15 17:50:51,051 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:51] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:50:51,357 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:50:51] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:52:57,126 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 17:52:57,436 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:53:03,063 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:53:03,085 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:53:07,226 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:07] "POST / HTTP/1.1" 200 -
2025-07-15 17:53:07,286 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:07] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:07,291 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:07] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:11,385 - schema_analyzer - INFO - Schema analysis completed for uploads\2e8ed402-2c98-413a-8048-72fc98438d6e_sample_bseg.csv
2025-07-15 17:53:11,388 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 17:53:11,390 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T17:53:11.390649",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "2e8ed402-2c98-413a-8048-72fc98438d6e",
    "file_size_mb": "0.0"
  }
}
2025-07-15 17:53:11,392 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:11] "POST /upload HTTP/1.1" 200 -
2025-07-15 17:53:11,500 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 17:53:11,695 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:11] "POST / HTTP/1.1" 200 -
2025-07-15 17:53:11,770 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:11] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:12,192 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:12] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:17,468 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 17:53:17,723 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:17] "POST / HTTP/1.1" 200 -
2025-07-15 17:53:17,822 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:17] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:17,823 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:17] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:26,565 - schema_analyzer - INFO - Schema analysis completed for uploads\2e8ed402-2c98-413a-8048-72fc98438d6e_sample_bseg.csv
2025-07-15 17:53:26,567 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 17:53:26,570 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T17:53:26.569388",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "2e8ed402-2c98-413a-8048-72fc98438d6e",
    "file_size_mb": "0.0"
  }
}
2025-07-15 17:53:26,572 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:26] "POST /upload HTTP/1.1" 200 -
2025-07-15 17:53:26,684 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 17:53:26,876 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:26] "POST / HTTP/1.1" 200 -
2025-07-15 17:53:26,959 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:26] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:27,260 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:27] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:31,142 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 17:53:31,144 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-15 17:53:31,147 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-15 17:53:31,992 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-fea037f6-1609-4597-b354-cc28c764b24b', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BSEG\n- Total Records: 30\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 67.59% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- KONTO: gl_account\n- SHKZG: debit_credit_indicator\n- DMBTR: local_amount\n- WRBTR: document_amount\n- LIFNR: vendor_number\n- KUNNR: customer_number\n'}, {'role': 'user', 'content': 'dog'}, {'role': 'system', 'content': '\nQuery Execution Results:\n- Rows returned: 1\n- Execution time: 0.00 seconds\n- Data summary: {}\n\nPlease provide business insights and recommendations based on these results.\n'}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 17:53:31,995 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 17:53:31,996 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 17:53:32,064 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000255489B2AC0>
2025-07-15 17:53:32,065 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000255483AE440> server_hostname='api.openai.com' timeout=5.0
2025-07-15 17:53:32,083 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000255489B2880>
2025-07-15 17:53:32,083 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 17:53:32,084 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 17:53:32,085 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 17:53:32,085 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 17:53:32,085 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 17:53:35,575 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 21:53:35 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'3053'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3055'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8964'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'6.216s'), (b'x-request-id', b'req_1b52f43f6bf5dbe95026a00a38a9784c'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=iLvzV.crXDBOfC9poQ8MWUvXRcXYhkm0EUOt7gSgTVg-1752616415-1.0.1.1-D7u.PGn42sIFJyiJfi_pzCa8ECjf7OeZe7aZ3ep8JHxP7hUznvcRvE7quQOWrW.2jnRD9_R9JcmQwIChGX7bYvISgzq3vZGR.8KtHzj_qDU; path=/; expires=Tue, 15-Jul-25 22:23:35 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=XNVm1ZcYGl.WTiLojNf_L0lNJjNhS0C_lNK_MCTf2to-1752616415208-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fc7e3d490a43f5-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 17:53:35,577 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 17:53:35,579 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 17:53:35,580 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 17:53:35,581 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 17:53:35,581 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 17:53:35,581 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 15 Jul 2025 21:53:35 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '3053'), ('openai-project', 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '3055'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '8964'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '6.216s'), ('x-request-id', 'req_1b52f43f6bf5dbe95026a00a38a9784c'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=iLvzV.crXDBOfC9poQ8MWUvXRcXYhkm0EUOt7gSgTVg-1752616415-1.0.1.1-D7u.PGn42sIFJyiJfi_pzCa8ECjf7OeZe7aZ3ep8JHxP7hUznvcRvE7quQOWrW.2jnRD9_R9JcmQwIChGX7bYvISgzq3vZGR.8KtHzj_qDU; path=/; expires=Tue, 15-Jul-25 22:23:35 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=XNVm1ZcYGl.WTiLojNf_L0lNJjNhS0C_lNK_MCTf2to-1752616415208-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95fc7e3d490a43f5-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-15 17:53:35,582 - openai._base_client - DEBUG - request_id: req_1b52f43f6bf5dbe95026a00a38a9784c
2025-07-15 17:53:35,605 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T17:53:35.605394",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 320,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "dog"
}
2025-07-15 17:53:35,610 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T17:53:35.607403",
  "user_question": "dog",
  "ai_response": "I'm sorry, but your input \"dog\" does not seem to be related to the SAP ECC financial data or Navy/DoD operations. Could you please provide more context or clarify your request? I'm here to help with queries related to SAP financial data, Navy-specific financial processes, procurement, compliance requirements, and more.",
  "processing_time_seconds": 4.467284202575684,
  "data_context": {
    "file_info": {
      "total_rows": "30",
      "total_columns": "29",
      "file_size_mb": "0.0",
      "analyzed_rows": "30"
    },
    "sap_table_type": "BSEG",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "30000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "15",
        "unique_percentage": "50.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000015.0",
          "mean": "1000000008.0",
          "sum": "30000000240.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "60720.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BUZEI": {
        "name": "BUZEI",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1.0",
          "max": "2.0",
          "mean": "1.5",
          "sum": "45.0"
        },
        "sap_patterns": []
      },
      "KOART": {
        "name": "KOART",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "KONTO": {
        "name": "KONTO",
        "dtype": "int64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "6",
        "unique_percentage": "20.0",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "100000.0",
          "max": "600000.0",
          "mean": "240666.66666666666",
          "sum": "7220000.0"
        },
        "sap_patterns": [
          "gl_account"
        ]
      },
      "SHKZG": {
        "name": "SHKZG",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "2",
        "unique_percentage": "6.67",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "debit_credit_indicator"
        ]
      },
      "DMBTR": {
        "name": "DMBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "local_amount"
        ]
      },
      "WRBTR": {
        "name": "WRBTR",
        "dtype": "float64",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "14",
        "unique_percentage": "46.67",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "800.0",
          "max": "7500.0",
          "mean": "3346.6666666666665",
          "sum": "100400.0"
        },
        "sap_patterns": [
          "document_amount"
        ]
      },
      "LIFNR": {
        "name": "LIFNR",
        "dtype": "object",
        "null_count": 25,
        "null_percentage": 83.33,
        "unique_count": "4",
        "unique_percentage": "13.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "vendor_number"
        ]
      },
      "KUNNR": {
        "name": "KUNNR",
        "dtype": "object",
        "null_count": 24,
        "null_percentage": 80.0,
        "unique_count": "3",
        "unique_percentage": "10.0",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "customer_number"
        ]
      },
      "KOSTL": {
        "name": "KOSTL",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "AUFNR": {
        "name": "AUFNR",
        "dtype": "object",
        "null_count": 29,
        "null_percentage": 96.67,
        "unique_count": "1",
        "unique_percentage": "3.33",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "PROJN": {
        "name": "PROJN",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "PSPNR": {
        "name": "PSPNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SAKNR": {
        "name": "SAKNR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZUONR": {
        "name": "ZUONR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "SGTXT": {
        "name": "SGTXT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "VALUT": {
        "name": "VALUT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZFBDT": {
        "name": "ZFBDT",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZTERM": {
        "name": "ZTERM",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSCH": {
        "name": "ZLSCH",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "ZLSPR": {
        "name": "ZLSPR",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSKZ": {
        "name": "MWSKZ",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MWSTS": {
        "name": "MWSTS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "HWBAS": {
        "name": "HWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "FWBAS": {
        "name": "FWBAS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MENGE": {
        "name": "MENGE",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      },
      "MEINS": {
        "name": "MEINS",
        "dtype": "float64",
        "null_count": 30,
        "null_percentage": 100.0,
        "unique_count": "0",
        "unique_percentage": "0.0",
        "data_category": "empty",
        "patterns": [],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 67.59
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show line items with amounts over $10,000",
      "Which accounts have the most transactions?",
      "Find debit vs credit entries"
    ],
    "schema_summary": "The uploaded file contains 29 columns from a BSEG table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BUZEI: Line Item - Sequential number within the document\n    KOART: Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)\n    KONTO: Account Number - G/L account, customer, or vendor number\n    SHKZG: Debit/Credit Indicator - S=Debit, H=Credit\n    DMBTR: Amount in Local Currency - Amount in local currency\n    WRBTR: Amount in Document Currency - Amount in document currency\n    LIFNR: Vendor Number - Vendor account number (if vendor transaction)\n    KUNNR: Customer Number - Customer account number (if customer transaction)\n    KOSTL: Cost Center - Cost center for cost allocation\n    AUFNR: Order Number - Internal order or project number\n    PROJN: Project Number - Project identifier\n    PSPNR: WBS Element - Work breakdown structure element\n    SAKNR: G/L Account Number - General ledger account\n    ZUONR: Assignment Number - Reference number for line item\n    SGTXT: Line Item Text - Description text for the line item\n    VALUT: Value Date - Date for interest calculation\n    ZFBDT: Baseline Date - Payment baseline date\n    ZTERM: Payment Terms - Payment terms code\n    ZLSCH: Payment Method - Payment method code\n    ZLSPR: Payment Block - Payment block indicator\n    MWSKZ: Tax Code - Tax code for the transaction\n    MWSTS: Tax Amount - Tax amount in local currency\n    HWBAS: Tax Base Amount - Base amount for tax calculation\n    FWBAS: Tax Base Amount in Document Currency - Tax base in document currency\n    MENGE: Quantity - Quantity for material transactions\n    MEINS: Unit of Measure - Unit of measure for quantity",
    "report_identification": {
      "table_type": "BSEG",
      "confidence": "1.0",
      "description": "Accounting Document Segment",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BUZEI",
        "KOART",
        "KONTO",
        "SHKZG",
        "DMBTR",
        "WRBTR",
        "LIFNR",
        "KUNNR",
        "KOSTL"
      ],
      "missing_columns": [],
      "extra_columns": [
        "AUFNR",
        "PROJN",
        "PSPNR",
        "SAKNR",
        "ZUONR",
        "SGTXT",
        "VALUT",
        "ZFBDT",
        "ZTERM",
        "ZLSCH",
        "ZLSPR",
        "MWSKZ",
        "MWSTS",
        "HWBAS",
        "FWBAS",
        "MENGE",
        "MEINS"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BUZEI": "Line Item - Sequential number within the document",
      "KOART": "Account Type - Type of account (D=Customer, K=Vendor, S=G/L Account)",
      "KONTO": "Account Number - G/L account, customer, or vendor number",
      "SHKZG": "Debit/Credit Indicator - S=Debit, H=Credit",
      "DMBTR": "Amount in Local Currency - Amount in local currency",
      "WRBTR": "Amount in Document Currency - Amount in document currency",
      "LIFNR": "Vendor Number - Vendor account number (if vendor transaction)",
      "KUNNR": "Customer Number - Customer account number (if customer transaction)",
      "KOSTL": "Cost Center - Cost center for cost allocation",
      "AUFNR": "Order Number - Internal order or project number",
      "PROJN": "Project Number - Project identifier",
      "PSPNR": "WBS Element - Work breakdown structure element",
      "SAKNR": "G/L Account Number - General ledger account",
      "ZUONR": "Assignment Number - Reference number for line item",
      "SGTXT": "Line Item Text - Description text for the line item",
      "VALUT": "Value Date - Date for interest calculation",
      "ZFBDT": "Baseline Date - Payment baseline date",
      "ZTERM": "Payment Terms - Payment terms code",
      "ZLSCH": "Payment Method - Payment method code",
      "ZLSPR": "Payment Block - Payment block indicator",
      "MWSKZ": "Tax Code - Tax code for the transaction",
      "MWSTS": "Tax Amount - Tax amount in local currency",
      "HWBAS": "Tax Base Amount - Base amount for tax calculation",
      "FWBAS": "Tax Base Amount in Document Currency - Tax base in document currency",
      "MENGE": "Quantity - Quantity for material transactions",
      "MEINS": "Unit of Measure - Unit of measure for quantity"
    }
  }
}
2025-07-15 17:53:35,748 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:35] "POST / HTTP/1.1" 200 -
2025-07-15 17:53:35,818 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:35] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:53:35,826 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:53:35] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:02,697 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 17:56:03,304 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:56:12,374 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:56:12,422 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 17:56:25,522 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:25] "POST / HTTP/1.1" 200 -
2025-07-15 17:56:25,577 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:25] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:25,697 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:25] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:36,472 - schema_analyzer - INFO - Schema analysis completed for uploads\2e8ed402-2c98-413a-8048-72fc98438d6e_sample_bseg.csv
2025-07-15 17:56:36,473 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 17:56:36,474 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T17:56:36.474978",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "2e8ed402-2c98-413a-8048-72fc98438d6e",
    "file_size_mb": "0.0"
  }
}
2025-07-15 17:56:36,476 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:36] "POST /upload HTTP/1.1" 200 -
2025-07-15 17:56:36,674 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:36] "POST / HTTP/1.1" 200 -
2025-07-15 17:56:36,820 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:36] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:37,052 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:37] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:41,647 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:41] "POST / HTTP/1.1" 200 -
2025-07-15 17:56:41,909 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:41] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:42,009 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:42] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:56:52,188 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:52] "[35m[1mPOST / HTTP/1.1[0m" 500 -
2025-07-15 17:56:52,305 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:52] "GET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1" 200 -
2025-07-15 17:56:52,454 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:52] "GET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1" 200 -
2025-07-15 17:56:52,796 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:52] "GET /?__debugger__=yes&cmd=resource&f=console.png&s=PPCfiXMhpeUSGQBRGjwD HTTP/1.1" 200 -
2025-07-15 17:56:53,037 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:56:53] "GET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1" 200 -
2025-07-15 17:57:56,402 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:57:56] "GET / HTTP/1.1" 200 -
2025-07-15 17:57:56,455 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:57:56] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:57:56,604 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:57:56] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:58:01,110 - schema_analyzer - INFO - Schema analysis completed for uploads\2e8ed402-2c98-413a-8048-72fc98438d6e_sample_bseg.csv
2025-07-15 17:58:01,111 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 17:58:01,111 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T17:58:01.111137",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "2e8ed402-2c98-413a-8048-72fc98438d6e",
    "file_size_mb": "0.0"
  }
}
2025-07-15 17:58:01,114 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:01] "POST /upload HTTP/1.1" 200 -
2025-07-15 17:58:01,367 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:01] "GET / HTTP/1.1" 200 -
2025-07-15 17:58:01,455 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:01] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 17:58:01,724 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:01] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 17:58:12,560 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:12] "[35m[1mPOST / HTTP/1.1[0m" 500 -
2025-07-15 17:58:12,843 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:12] "[36mGET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 304 -
2025-07-15 17:58:12,922 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:12] "[36mGET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 304 -
2025-07-15 17:58:13,233 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:13] "[36mGET /?__debugger__=yes&cmd=resource&f=console.png&s=PPCfiXMhpeUSGQBRGjwD HTTP/1.1[0m" 304 -
2025-07-15 17:58:13,484 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:58:13] "[36mGET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 304 -
2025-07-15 17:59:02,717 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:59:02] "[35m[1mPOST / HTTP/1.1[0m" 500 -
2025-07-15 17:59:02,780 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:59:02] "[36mGET /?__debugger__=yes&cmd=resource&f=style.css HTTP/1.1[0m" 304 -
2025-07-15 17:59:03,120 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:59:03] "[36mGET /?__debugger__=yes&cmd=resource&f=debugger.js HTTP/1.1[0m" 304 -
2025-07-15 17:59:03,520 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:59:03] "[36mGET /?__debugger__=yes&cmd=resource&f=console.png&s=PPCfiXMhpeUSGQBRGjwD HTTP/1.1[0m" 304 -
2025-07-15 17:59:03,771 - werkzeug - INFO - 127.0.0.1 - - [15/Jul/2025 17:59:03] "[36mGET /?__debugger__=yes&cmd=resource&f=console.png HTTP/1.1[0m" 304 -
2025-07-15 17:59:32,270 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 17:59:32,468 - werkzeug - INFO -  * Restarting with stat
2025-07-15 17:59:37,634 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 17:59:37,657 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:00:03,058 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:00:03,060 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:00:03,061 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:00:05,688 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:00:05,701 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:00:19,227 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:19] "GET / HTTP/1.1" 200 -
2025-07-15 18:00:19,308 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:19] "GET /static/its_consulting_logo_transparent.png HTTP/1.1" 200 -
2025-07-15 18:00:19,314 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:19] "GET /static/its_consulting_logo_small.png HTTP/1.1" 200 -
2025-07-15 18:00:19,672 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:19] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-15 18:00:25,252 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bseg.csv
2025-07-15 18:00:25,254 - report_identifier - INFO - Identified report type: BSEG (confidence: 1.00)
2025-07-15 18:00:25,255 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:00:25.255334",
  "operation": "file_uploaded",
  "table": "sample_bseg.csv",
  "record_count": 30,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:00:25,257 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:25] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:00:25,430 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:25] "GET / HTTP/1.1" 200 -
2025-07-15 18:00:25,529 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:25] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:00:25,553 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:25] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:00:31,889 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:31] "POST / HTTP/1.1" 200 -
2025-07-15 18:00:31,951 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:31] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:00:31,971 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:00:31] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:02:00,020 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:02:00,258 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:02:00] "POST / HTTP/1.1" 200 -
2025-07-15 18:02:00,436 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:02:00] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:02:00,462 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:02:00] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:03:41,773 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:03:41,773 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:03:41,775 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:03:44,711 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:03:44,730 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:03:55,620 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:03:55] "POST / HTTP/1.1" 200 -
2025-07-15 18:03:55,692 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:03:55] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:03:55,709 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:03:55] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:04:18,462 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:18] "GET / HTTP/1.1" 200 -
2025-07-15 18:04:18,542 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:18] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:04:18,549 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:18] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:04:25,496 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:04:25,498 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:04:25,505 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:04:25.505787",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:04:25,510 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:25] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:04:25,652 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:25] "GET / HTTP/1.1" 200 -
2025-07-15 18:04:25,717 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:25] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:04:25,754 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:25] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:04:35,922 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:04:36,019 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:36] "POST / HTTP/1.1" 200 -
2025-07-15 18:04:36,093 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:36] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:04:36,121 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:04:36] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:07:57,210 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:07:57,250 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-15 18:07:57,253 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-15 18:07:57,259 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-15 18:07:58,131 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-71a8cf1a-8695-4169-8be4-4dd796b33a25', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BKPF\n- Total Records: 27\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 16.14% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- BLART: document_type\n- BUDAT: posting_date\n- WAERS: currency\n'}, {'role': 'user', 'content': 'what transaction codes were used most frequently?'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 27\n- Execution time: 0.00 seconds\n- Data summary: {'total_rows': 27, 'total_columns': 14, 'column_stats': {'BUKRS': {'min': 1000.0, 'max': 1000.0, 'mean': 1000.0, 'sum': 25000.0}, 'BELNR': {'min': 1000000001.0, 'max': 1000000036.0, 'mean': 1000000016.56, 'sum': 25000000414.0}, 'GJAHR': {'min': 2024.0, 'max': 2024.0, 'mean': 2024.0, 'sum': 50600.0}, 'BUDAT': {'min_date': '2024-01-15T00:00:00', 'max_date': '2024-06-15T00:00:00', 'date_range_days': 152}, 'WAERS': {'unique_values': 1, 'top_values': {'USD': 25}}, 'USNAM': {'unique_values': 1, 'top_values': {'SMITH': 25}}, 'CPUDT': {'min_date': '2024-01-15T00:00:00', 'max_date': '2024-06-15T00:00:00', 'date_range_days': 152}, 'CPUTM': {'min_date': '2025-07-15T08:15:30', 'max_date': '2025-07-15T16:45:12', 'date_range_days': 0}, 'AWKEY': {'min': 2.024011510001e+21, 'max': 2.024061510001e+21, 'mean': 2.024028102001e+21, 'sum': 5.0600702550025e+22}}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 18:07:58,134 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 18:07:58,136 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 18:07:58,239 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013297273D00>
2025-07-15 18:07:58,239 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000013296C5E2C0> server_hostname='api.openai.com' timeout=5.0
2025-07-15 18:07:58,260 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000013297273AC0>
2025-07-15 18:07:58,260 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 18:07:58,260 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 18:07:58,260 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 18:07:58,262 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 18:07:58,262 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 18:08:08,750 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 22:08:08 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'10209'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'10213'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8760'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'7.44s'), (b'x-request-id', b'req_a36de2cf1e25c61900dc30d9939f66ba'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=ZS.4H6uNtxCEPtCskd9airzrL11VATQIBmbCL3DILfA-1752617288-1.0.1.1-RYZS4skFWsBcn0AOzu2qCJjS90zGN3NP1CEaY43yc5ZlE_GePdAraAUuyWpzzM0Upfp8vr76Qy1MfYvS.bMNHLONxdbTkOXOGk8Fog.lxlw; path=/; expires=Tue, 15-Jul-25 22:38:08 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=terU6QS8KwcIrMpnqcU2s3zApu9JrtIR1T8l5vQvs24-1752617288391-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fc9362fb272593-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 18:08:08,752 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 18:08:08,753 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 18:08:08,754 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 18:08:08,754 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 18:08:08,754 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 18:08:08,754 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 15 Jul 2025 22:08:08 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '10209'), ('openai-project', 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '10213'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '8760'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '7.44s'), ('x-request-id', 'req_a36de2cf1e25c61900dc30d9939f66ba'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=ZS.4H6uNtxCEPtCskd9airzrL11VATQIBmbCL3DILfA-1752617288-1.0.1.1-RYZS4skFWsBcn0AOzu2qCJjS90zGN3NP1CEaY43yc5ZlE_GePdAraAUuyWpzzM0Upfp8vr76Qy1MfYvS.bMNHLONxdbTkOXOGk8Fog.lxlw; path=/; expires=Tue, 15-Jul-25 22:38:08 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=terU6QS8KwcIrMpnqcU2s3zApu9JrtIR1T8l5vQvs24-1752617288391-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95fc9362fb272593-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-15 18:08:08,754 - openai._base_client - DEBUG - request_id: req_a36de2cf1e25c61900dc30d9939f66ba
2025-07-15 18:08:08,764 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T18:08:08.764762",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 1544,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "what transaction codes were used most frequently?"
}
2025-07-15 18:08:08,768 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T18:08:08.766762",
  "user_question": "what transaction codes were used most frequently?",
  "ai_response": "Based on the query execution results, it appears that the data does not include transaction codes as a field. Transaction codes in SAP are typically used to identify specific types of transactions or activities. However, we can infer some insights from the available data.\n\nThe data set includes 27 records, all from the same company code (1000), indicating that all transactions belong to the same organizational unit or department. All transactions occurred in the fiscal year 2024, with posting dates ranging from January 15, 2024, to June 15, 2024.\n\nThe currency for all transactions is USD, and all transactions were processed by the same user ('SMITH'). The 'AWKEY' field, which typically represents a reference to an associated document, shows a range of values, suggesting that these transactions may be related to various different activities or processes.\n\nWithout the specific transaction codes, it's challenging to identify the most frequent types of transactions. However, the uniformity of the company code, currency, and user suggests a consistent set of processes or activities. \n\nFor more detailed analysis, it would be beneficial to include additional fields in the data extraction, such as transaction codes or document types. This would allow for a more granular understanding of the most common types of financial activities within this department. \n\nRemember, it's important to maintain data accuracy and audit trails for DoD requirements and to ensure compliance with government accounting standards and Navy regulations.",
  "processing_time_seconds": 11.562929630279541,
  "data_context": {
    "file_info": {
      "total_rows": "27",
      "total_columns": "14",
      "file_size_mb": "0.0",
      "analyzed_rows": "27"
    },
    "sap_table_type": "BKPF",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "11.11",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "25000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000036.0",
          "mean": "1000000016.56",
          "sum": "25000000414.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "50600.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BLART": {
        "name": "BLART",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "document_type"
        ]
      },
      "BUDAT": {
        "name": "BUDAT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": [
          "posting_date"
        ]
      },
      "WAERS": {
        "name": "WAERS",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "currency"
        ]
      },
      "BKTXT": {
        "name": "BKTXT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "22",
        "unique_percentage": "81.48",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "USNAM": {
        "name": "USNAM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": []
      },
      "TCODE": {
        "name": "TCODE",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "CPUDT": {
        "name": "CPUDT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": []
      },
      "CPUTM": {
        "name": "CPUTM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "19",
        "unique_percentage": "70.37",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2025-07-15T08:15:30",
          "max_date": "2025-07-15T16:45:12",
          "date_range_days": "0"
        },
        "sap_patterns": []
      },
      "XBLNR": {
        "name": "XBLNR",
        "dtype": "object",
        "null_count": 13,
        "null_percentage": 48.15,
        "unique_count": "14",
        "unique_percentage": "51.85",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "AWKEY": {
        "name": "AWKEY",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2.024011510001e+21",
          "max": "2.024061510001e+21",
          "mean": "2.0240281020010002e+21",
          "sum": "5.0600702550025005e+22"
        },
        "sap_patterns": []
      },
      "XREVERSED": {
        "name": "XREVERSED",
        "dtype": "object",
        "null_count": 26,
        "null_percentage": 96.3,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 16.14
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show documents posted in the last 30 days",
      "Which document types have the highest volume?",
      "Find documents with specific posting dates"
    ],
    "schema_summary": "The uploaded file contains 14 columns from a BKPF table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity or department\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BLART: Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)\n    BUDAT: Posting Date - Date when document was posted to the system\n    WAERS: Currency - Document currency code (USD, EUR, etc.)\n    BKTXT: Document Header Text - Description or reference text\n    USNAM: User Name - User who posted the document\n    TCODE: Transaction Code - SAP transaction used to create document\n    CPUDT: CPU Date - System date when document was created\n    CPUTM: CPU Time - System time when document was created\n    XBLNR: Reference Document Number - External reference number\n    AWKEY: Object Key - Internal system key for the document\n    XREVERSED: Reversed Document - Flag indicating if document was reversed",
    "report_identification": {
      "table_type": "BKPF",
      "confidence": "1.0",
      "description": "Accounting Document Header",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BLART",
        "BUDAT",
        "WAERS",
        "BKTXT",
        "USNAM",
        "TCODE",
        "CPUDT"
      ],
      "missing_columns": [],
      "extra_columns": [
        "CPUTM",
        "XBLNR",
        "AWKEY",
        "XREVERSED"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity or department",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BLART": "Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)",
      "BUDAT": "Posting Date - Date when document was posted to the system",
      "WAERS": "Currency - Document currency code (USD, EUR, etc.)",
      "BKTXT": "Document Header Text - Description or reference text",
      "USNAM": "User Name - User who posted the document",
      "TCODE": "Transaction Code - SAP transaction used to create document",
      "CPUDT": "CPU Date - System date when document was created",
      "CPUTM": "CPU Time - System time when document was created",
      "XBLNR": "Reference Document Number - External reference number",
      "AWKEY": "Object Key - Internal system key for the document",
      "XREVERSED": "Reversed Document - Flag indicating if document was reversed"
    }
  }
}
2025-07-15 18:08:08,876 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:08:08] "POST / HTTP/1.1" 200 -
2025-07-15 18:08:08,936 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:08:08] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:08:08,948 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:08:08] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:09:40,074 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 18:09:40,349 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:09:45,176 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:09:45,211 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:10:18,050 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:10:18,051 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:10:18,053 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:10:21,646 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:10:21,665 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:10:31,524 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:31] "GET / HTTP/1.1" 200 -
2025-07-15 18:10:31,574 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:31] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:10:31,593 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:31] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:10:37,346 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:10:37,354 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:10:37,356 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:10:37.356020",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:10:37,360 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:37] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:10:37,549 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:37] "GET / HTTP/1.1" 200 -
2025-07-15 18:10:37,630 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:37] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:10:37,659 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:10:37] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:11:09,957 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:11:10,041 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:11:10] "POST / HTTP/1.1" 200 -
2025-07-15 18:11:10,100 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:11:10] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:11:10,107 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:11:10] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:14:54,340 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:14:54,526 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:14:58,552 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:14:58,577 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:15:08,021 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 18:15:08,166 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:15:12,908 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:15:12,931 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:15:48,048 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:15:48,049 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:15:48,052 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:15:50,456 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:15:50,468 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:16:16,627 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:16] "GET / HTTP/1.1" 200 -
2025-07-15 18:16:16,677 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:16] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:16:16,683 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:16] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:16:26,480 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:16:26,486 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:16:26,487 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:16:26.487574",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:16:26,490 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:26] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:16:26,607 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:26] "GET / HTTP/1.1" 200 -
2025-07-15 18:16:26,658 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:26] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:16:26,676 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:26] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:16:42,226 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:16:42,315 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:42] "POST / HTTP/1.1" 200 -
2025-07-15 18:16:42,383 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:42] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:16:42,399 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:16:42] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:17:41,719 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:17:41,888 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:17:45,375 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:17:45,388 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:18:04,859 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:18:04,860 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:18:04,862 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:18:07,789 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:18:07,805 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:18:16,858 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:16] "GET / HTTP/1.1" 200 -
2025-07-15 18:18:16,899 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:16] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:18:16,945 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:16] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:18:22,822 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:18:22,827 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:18:22,835 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:18:22.834584",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:18:22,838 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:22] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:18:23,134 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:23] "GET / HTTP/1.1" 200 -
2025-07-15 18:18:23,213 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:23] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:18:23,239 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:23] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:18:26,850 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:18:26,937 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:26] "POST / HTTP/1.1" 200 -
2025-07-15 18:18:26,995 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:26] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:18:27,019 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:18:27] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:19:49,766 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:19:49,915 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:19:55,347 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:19:55,368 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:20:09,108 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:20:09,109 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:20:09,110 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:20:12,548 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:20:12,569 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:20:23,094 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:23] "GET / HTTP/1.1" 200 -
2025-07-15 18:20:23,165 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:23] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:20:23,201 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:23] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:20:28,547 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:20:28,549 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:20:28,553 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:20:28.553466",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:20:28,556 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:28] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:20:28,737 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:28] "GET / HTTP/1.1" 200 -
2025-07-15 18:20:28,796 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:28] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:20:28,827 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:28] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:20:31,494 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:20:31,589 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:31] "POST / HTTP/1.1" 200 -
2025-07-15 18:20:31,625 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:31] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:20:31,642 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:20:31] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:24:48,583 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:24:48,851 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:24:53,213 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:24:53,235 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:25:57,409 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 18:25:57,671 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:26:05,366 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:26:05,386 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:26:15,729 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\app.py', reloading
2025-07-15 18:26:16,073 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:26:25,712 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:26:25,738 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:27:26,228 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:27:26,229 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:27:26,235 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:27:28,563 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:27:28,574 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:28:46,312 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:46] "GET / HTTP/1.1" 200 -
2025-07-15 18:28:46,380 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:46] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:28:46,492 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:46] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:28:49,851 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:28:49,853 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:28:49,856 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:28:49,858 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:28:49.857930",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:28:49,863 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:49] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:28:50,005 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:50] "GET / HTTP/1.1" 200 -
2025-07-15 18:28:50,075 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:50] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:28:50,085 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:50] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:28:53,097 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:28:53,183 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:53] "POST / HTTP/1.1" 200 -
2025-07-15 18:28:53,248 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:53] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:28:53,256 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:28:53] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:31:05,619 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 18:31:05,977 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:31:11,714 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:31:11,778 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:31:46,034 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:31:46,036 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:31:46,038 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:31:48,808 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:31:48,830 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:31:55,310 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:31:55] "GET / HTTP/1.1" 200 -
2025-07-15 18:31:55,381 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:31:55] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:31:55,418 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:31:55] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:32:02,292 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:32:02,293 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:32:02,294 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:32:02,294 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:32:02.294140",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:32:02,296 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:02] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:32:02,478 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:02] "GET / HTTP/1.1" 200 -
2025-07-15 18:32:02,531 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:02] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:32:02,547 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:02] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:32:06,456 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:32:06,456 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:32:06,457 - query_executor - INFO - [DEBUG] Query plan grouping: [], aggregation: {}
2025-07-15 18:32:06,584 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:06] "POST / HTTP/1.1" 200 -
2025-07-15 18:32:06,644 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:06] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:32:06,669 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:32:06] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:33:47,368 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:33:47,577 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:33:52,602 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:33:52,616 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:33:59,593 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:33:59,594 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:33:59,598 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:34:03,016 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:34:03,028 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:34:08,908 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:08] "POST / HTTP/1.1" 200 -
2025-07-15 18:34:08,998 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:08] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:09,039 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:09] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:14,423 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:34:14,425 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:34:14,426 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:34:14,427 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:34:14.427449",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:34:14,429 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:14] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:34:14,534 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:34:14,535 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:34:14,535 - query_executor - INFO - [DEBUG] Query plan grouping: [], aggregation: {}
2025-07-15 18:34:14,658 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:14] "POST / HTTP/1.1" 200 -
2025-07-15 18:34:14,718 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:14] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:14,731 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:14] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:16,983 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:34:16,984 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:34:16,984 - query_executor - INFO - [DEBUG] Query plan grouping: [], aggregation: {}
2025-07-15 18:34:17,128 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:17] "POST / HTTP/1.1" 200 -
2025-07-15 18:34:17,195 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:17] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:17,218 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:17] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:18,738 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:34:18,739 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:34:18,739 - query_executor - INFO - [DEBUG] Query plan grouping: [], aggregation: {}
2025-07-15 18:34:18,830 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:18] "POST / HTTP/1.1" 200 -
2025-07-15 18:34:18,899 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:18] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:34:18,915 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:34:18] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:35:37,190 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:35:37,447 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:35:42,054 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:35:42,070 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:36:07,208 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:36:07,208 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:36:07,210 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:36:09,776 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:36:09,789 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:36:17,422 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:17] "GET / HTTP/1.1" 200 -
2025-07-15 18:36:17,636 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:17] "GET /static/its_consulting_logo_transparent.png HTTP/1.1" 200 -
2025-07-15 18:36:17,642 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:17] "GET /static/its_consulting_logo_small.png HTTP/1.1" 200 -
2025-07-15 18:36:28,801 - schema_analyzer - INFO - Schema analysis completed for uploads\11f001a7-4abe-4403-9189-bb01b1e92a71_sample_bkpf.csv
2025-07-15 18:36:28,801 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:36:28,802 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:36:28,804 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:36:28.803580",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "11f001a7-4abe-4403-9189-bb01b1e92a71",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:36:28,806 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:28] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:36:28,921 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:28] "GET / HTTP/1.1" 200 -
2025-07-15 18:36:29,009 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:29] "GET /static/its_consulting_logo_transparent.png HTTP/1.1" 200 -
2025-07-15 18:36:29,009 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:29] "GET /static/its_consulting_logo_small.png HTTP/1.1" 200 -
2025-07-15 18:36:29,079 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:29] "[33mGET /favicon.ico HTTP/1.1[0m" 404 -
2025-07-15 18:36:39,177 - query_planner - INFO - [DEBUG] Parsing question: 'what transaction codes were used most frequently?'
2025-07-15 18:36:39,177 - query_planner - INFO - [DEBUG] Testing pattern: 'most frequent ([\w\s]+)' - Match: False
2025-07-15 18:36:39,178 - query_planner - INFO - [DEBUG] Testing pattern: 'most common ([\w\s]+)' - Match: False
2025-07-15 18:36:39,178 - query_planner - INFO - [DEBUG] Testing pattern: 'top (\d+) ([\w\s]+)' - Match: False
2025-07-15 18:36:39,180 - query_planner - INFO - [DEBUG] Testing pattern: 'top ([\w\s]+)' - Match: False
2025-07-15 18:36:39,180 - query_planner - INFO - [DEBUG] Testing pattern: 'which ([\w\s]+) are used most' - Match: False
2025-07-15 18:36:39,180 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) are used most' - Match: False
2025-07-15 18:36:39,181 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most common ([\w\s]+)' - Match: False
2025-07-15 18:36:39,182 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most frequent ([\w\s]+)' - Match: False
2025-07-15 18:36:39,198 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:36:39,199 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:36:39,200 - query_executor - INFO - [DEBUG] Query plan grouping: [], aggregation: {}
2025-07-15 18:36:39,292 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:39] "POST / HTTP/1.1" 200 -
2025-07-15 18:36:39,417 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:39] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:36:39,424 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:36:39] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:37:38,544 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:37:38,787 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:37:42,625 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:37:42,654 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:37:54,946 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:37:54,947 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:37:54,951 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:38:01,235 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:38:01,275 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:38:16,884 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:16] "GET / HTTP/1.1" 200 -
2025-07-15 18:38:17,039 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:17] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:38:17,100 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:17] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:38:23,765 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:38:23,773 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:38:23,778 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:38:23,803 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:38:23.803057",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:38:23,907 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:23] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:38:24,364 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:24] "GET / HTTP/1.1" 200 -
2025-07-15 18:38:24,455 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:24] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:38:24,553 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:24] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:38:28,077 - query_planner - INFO - [DEBUG] Parsing question: 'what transaction codes were used most frequently?'
2025-07-15 18:38:28,225 - query_planner - INFO - [DEBUG] Testing pattern: 'most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,318 - query_planner - INFO - [DEBUG] Testing pattern: 'most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,343 - query_planner - INFO - [DEBUG] Testing pattern: 'top (\d+) ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,450 - query_planner - INFO - [DEBUG] Testing pattern: 'top ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,497 - query_planner - INFO - [DEBUG] Testing pattern: 'which ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,531 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,591 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,644 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:38:28,948 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:38:28,958 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:38:28,973 - query_executor - INFO - [DEBUG] Query plan grouping: [], aggregation: {}
2025-07-15 18:38:29,525 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:29] "POST / HTTP/1.1" 200 -
2025-07-15 18:38:29,646 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:29] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:38:29,735 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:38:29] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:39:24,221 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_planner.py', reloading
2025-07-15 18:39:24,415 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:39:28,211 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:39:28,234 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:39:39,220 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:39:39,221 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:39:39,223 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:39:42,562 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:39:42,576 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:39:48,349 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:48] "GET / HTTP/1.1" 200 -
2025-07-15 18:39:48,407 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:48] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:39:48,435 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:48] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:39:53,030 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:39:53,040 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:39:53,046 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:39:53,051 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:39:53.051070",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:39:53,056 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:53] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:39:53,258 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:53] "GET / HTTP/1.1" 200 -
2025-07-15 18:39:53,335 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:53] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:39:53,355 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:39:53] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:39:55,621 - query_planner - INFO - [DEBUG] Parsing question: 'what transaction codes were used most frequently?'
2025-07-15 18:39:55,621 - query_planner - INFO - [DEBUG] Testing pattern: 'most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,623 - query_planner - INFO - [DEBUG] Testing pattern: 'most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,624 - query_planner - INFO - [DEBUG] Testing pattern: 'top (\d+) ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,625 - query_planner - INFO - [DEBUG] Testing pattern: 'top ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,625 - query_planner - INFO - [DEBUG] Testing pattern: 'which ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,626 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,627 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,628 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:39:55,629 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) were used most frequently[\s\?\.!]*$' - Match: True
2025-07-15 18:39:55,644 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:39:55,645 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:39:55,646 - query_executor - INFO - [DEBUG] Query plan grouping: ['TCODE'], aggregation: {'*': 'count'}
2025-07-15 18:39:55,650 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: DataFrame columns: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:39:55,651 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: grouping=['TCODE'], aggregation={'*': 'count'}
2025-07-15 18:39:55,661 - query_executor - INFO - Query executed successfully in 0.01 seconds
2025-07-15 18:39:55,669 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-15 18:39:55,676 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-15 18:39:56,789 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-9871b2cc-599b-4b64-9115-5513e88195a0', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BKPF\n- Total Records: 27\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 16.14% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- BLART: document_type\n- BUDAT: posting_date\n- WAERS: currency\n'}, {'role': 'user', 'content': 'what transaction codes were used most frequently?'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 5\n- Execution time: 0.01 seconds\n- Data summary: {'total_rows': 5, 'total_columns': 2, 'column_stats': {}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 18:39:56,791 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 18:39:56,792 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 18:39:56,830 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000020059F8BB80>
2025-07-15 18:39:56,830 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000020059860240> server_hostname='api.openai.com' timeout=5.0
2025-07-15 18:39:56,851 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000020059F8B940>
2025-07-15 18:39:56,851 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 18:39:56,852 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 18:39:56,852 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 18:39:56,853 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 18:39:56,853 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 18:40:04,533 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 22:40:04 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'7095'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'7098'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8960'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'6.24s'), (b'x-request-id', b'req_a0f8c507bebd6142a3485cbd4a17c854'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=wQs_eUrZKIdT0Tq95YpbP2H9e74_auJzjj.Tq5FRJ70-1752619204-1.0.1.1-N1.Gi3cBgoBQJzeci8UkaFWOt0ElOcVHz9GSmChVjYgSlUyQWep8O3xLF.1P1tLMVmgNm0aqfCjCijOdtzJvTtWRHg.bUrv89AgscutM.fQ; path=/; expires=Tue, 15-Jul-25 23:10:04 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=ax5A2vRzinx4vFeOWBYHriiTKfQSAkkH3oTHoOCUxqI-1752619204196-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fcc23a4c946dbc-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 18:40:04,536 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 18:40:04,537 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 18:40:04,538 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 18:40:04,538 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 18:40:04,539 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 18:40:04,539 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 15 Jul 2025 22:40:04 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '7095'), ('openai-project', 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '7098'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '8960'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '6.24s'), ('x-request-id', 'req_a0f8c507bebd6142a3485cbd4a17c854'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=wQs_eUrZKIdT0Tq95YpbP2H9e74_auJzjj.Tq5FRJ70-1752619204-1.0.1.1-N1.Gi3cBgoBQJzeci8UkaFWOt0ElOcVHz9GSmChVjYgSlUyQWep8O3xLF.1P1tLMVmgNm0aqfCjCijOdtzJvTtWRHg.bUrv89AgscutM.fQ; path=/; expires=Tue, 15-Jul-25 23:10:04 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=ax5A2vRzinx4vFeOWBYHriiTKfQSAkkH3oTHoOCUxqI-1752619204196-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95fcc23a4c946dbc-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-15 18:40:04,539 - openai._base_client - DEBUG - request_id: req_a0f8c507bebd6142a3485cbd4a17c854
2025-07-15 18:40:04,556 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T18:40:04.555359",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 966,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "what transaction codes were used most frequently?"
}
2025-07-15 18:40:04,559 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T18:40:04.558460",
  "user_question": "what transaction codes were used most frequently?",
  "ai_response": "I'm sorry for the confusion, but the information provided doesn't include the specific transaction codes used. The BKPF table in SAP ECC does not contain a field for transaction codes. Transaction codes are typically used in SAP to navigate to a particular application or function, and they are not typically stored in financial tables like BKPF.\n\nHowever, the BKPF table does include a field for document types (BLART), which can give an indication of the kind of transactions that have been processed. Document types include codes like K1 for customer invoices, K2 for customer payments, S1 for vendor invoices, S2 for vendor payments, and G1 for G/L documents.\n\nIf you're interested in understanding the frequency of different types of transactions, you could consider querying the BKPF table for a count of records by document type. This would give you an idea of the volume of different types of financial transactions processed by the Navy or DoD organization.",
  "processing_time_seconds": 8.937062740325928,
  "data_context": {
    "file_info": {
      "total_rows": "27",
      "total_columns": "14",
      "file_size_mb": "0.0",
      "analyzed_rows": "27"
    },
    "sap_table_type": "BKPF",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "11.11",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "25000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000036.0",
          "mean": "1000000016.56",
          "sum": "25000000414.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "50600.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BLART": {
        "name": "BLART",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "document_type"
        ]
      },
      "BUDAT": {
        "name": "BUDAT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": [
          "posting_date"
        ]
      },
      "WAERS": {
        "name": "WAERS",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "currency"
        ]
      },
      "BKTXT": {
        "name": "BKTXT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "22",
        "unique_percentage": "81.48",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "USNAM": {
        "name": "USNAM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": []
      },
      "TCODE": {
        "name": "TCODE",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "CPUDT": {
        "name": "CPUDT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": []
      },
      "CPUTM": {
        "name": "CPUTM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "19",
        "unique_percentage": "70.37",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2025-07-15T08:15:30",
          "max_date": "2025-07-15T16:45:12",
          "date_range_days": "0"
        },
        "sap_patterns": []
      },
      "XBLNR": {
        "name": "XBLNR",
        "dtype": "object",
        "null_count": 13,
        "null_percentage": 48.15,
        "unique_count": "14",
        "unique_percentage": "51.85",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "AWKEY": {
        "name": "AWKEY",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2.024011510001e+21",
          "max": "2.024061510001e+21",
          "mean": "2.0240281020010002e+21",
          "sum": "5.0600702550025005e+22"
        },
        "sap_patterns": []
      },
      "XREVERSED": {
        "name": "XREVERSED",
        "dtype": "object",
        "null_count": 26,
        "null_percentage": 96.3,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 16.14
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show documents posted in the last 30 days",
      "Which document types have the highest volume?",
      "Find documents with specific posting dates"
    ],
    "schema_summary": "The uploaded file contains 14 columns from a BKPF table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity or department\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BLART: Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)\n    BUDAT: Posting Date - Date when document was posted to the system\n    WAERS: Currency - Document currency code (USD, EUR, etc.)\n    BKTXT: Document Header Text - Description or reference text\n    USNAM: User Name - User who posted the document\n    TCODE: Transaction Code - SAP transaction used to create document\n    CPUDT: CPU Date - System date when document was created\n    CPUTM: CPU Time - System time when document was created\n    XBLNR: Reference Document Number - External reference number\n    AWKEY: Object Key - Internal system key for the document\n    XREVERSED: Reversed Document - Flag indicating if document was reversed",
    "report_identification": {
      "table_type": "BKPF",
      "confidence": "1.0",
      "description": "Accounting Document Header",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BLART",
        "BUDAT",
        "WAERS",
        "BKTXT",
        "USNAM",
        "TCODE",
        "CPUDT"
      ],
      "missing_columns": [],
      "extra_columns": [
        "CPUTM",
        "XBLNR",
        "AWKEY",
        "XREVERSED"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity or department",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BLART": "Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)",
      "BUDAT": "Posting Date - Date when document was posted to the system",
      "WAERS": "Currency - Document currency code (USD, EUR, etc.)",
      "BKTXT": "Document Header Text - Description or reference text",
      "USNAM": "User Name - User who posted the document",
      "TCODE": "Transaction Code - SAP transaction used to create document",
      "CPUDT": "CPU Date - System date when document was created",
      "CPUTM": "CPU Time - System time when document was created",
      "XBLNR": "Reference Document Number - External reference number",
      "AWKEY": "Object Key - Internal system key for the document",
      "XREVERSED": "Reversed Document - Flag indicating if document was reversed"
    }
  }
}
2025-07-15 18:40:04,669 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:40:04] "POST / HTTP/1.1" 200 -
2025-07-15 18:40:04,738 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:40:04] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:40:04,754 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:40:04] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:41:10,088 - werkzeug - INFO -  * Detected change in 'C:\\Users\\peytonhl\\Documents\\ITS Consulting Inc\\SAP AI Demo\\query_executor.py', reloading
2025-07-15 18:41:10,435 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:41:15,655 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:41:15,674 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:41:22,902 - werkzeug - INFO - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://192.168.1.71:5000
2025-07-15 18:41:22,902 - werkzeug - INFO - [33mPress CTRL+C to quit[0m
2025-07-15 18:41:22,905 - werkzeug - INFO -  * Restarting with stat
2025-07-15 18:41:26,347 - werkzeug - WARNING -  * Debugger is active!
2025-07-15 18:41:26,363 - werkzeug - INFO -  * Debugger PIN: 657-670-264
2025-07-15 18:41:31,552 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:31] "GET / HTTP/1.1" 200 -
2025-07-15 18:41:31,611 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:31] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:41:31,625 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:31] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:41:37,400 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:41:37,402 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:41:37,403 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:41:37,406 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:41:37.404546",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:41:37,408 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:37] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:41:37,570 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:37] "GET / HTTP/1.1" 200 -
2025-07-15 18:41:37,662 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:37] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:41:37,689 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:37] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:41:40,415 - query_planner - INFO - [DEBUG] Parsing question: 'what transaction codes were used most frequently?'
2025-07-15 18:41:40,416 - query_planner - INFO - [DEBUG] Testing pattern: 'most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,416 - query_planner - INFO - [DEBUG] Testing pattern: 'most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,417 - query_planner - INFO - [DEBUG] Testing pattern: 'top (\d+) ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,419 - query_planner - INFO - [DEBUG] Testing pattern: 'top ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,420 - query_planner - INFO - [DEBUG] Testing pattern: 'which ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,421 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,421 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,422 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:41:40,423 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) were used most frequently[\s\?\.!]*$' - Match: True
2025-07-15 18:41:40,444 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:41:40,444 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:41:40,445 - query_executor - INFO - [DEBUG] Query plan grouping: ['TCODE'], aggregation: {'*': 'count'}
2025-07-15 18:41:40,447 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: DataFrame columns: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:41:40,449 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: grouping=['TCODE'], aggregation={'*': 'count'}
2025-07-15 18:41:40,457 - query_executor - INFO - Query executed successfully in 0.01 seconds
2025-07-15 18:41:40,459 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-07-15 18:41:40,468 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\peytonhl\\AppData\\Roaming\\Python\\Python38\\site-packages\\certifi\\cacert.pem'
2025-07-15 18:41:41,939 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-0820cafe-f53a-4177-a6fa-844ae0803d75', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BKPF\n- Total Records: 27\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 16.14% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- BLART: document_type\n- BUDAT: posting_date\n- WAERS: currency\n'}, {'role': 'user', 'content': 'what transaction codes were used most frequently?'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 5\n- Execution time: 0.01 seconds\n- Data summary: {'total_rows': 5, 'total_columns': 2, 'column_stats': {}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 18:41:41,943 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 18:41:41,944 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 18:41:41,990 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000211C5E0BAF0>
2025-07-15 18:41:41,991 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000211C5C39240> server_hostname='api.openai.com' timeout=5.0
2025-07-15 18:41:42,010 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000211C5E0B940>
2025-07-15 18:41:42,010 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 18:41:42,010 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 18:41:42,011 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 18:41:42,011 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 18:41:42,013 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 18:41:46,827 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 22:41:46 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'4343'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4352'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8960'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'6.24s'), (b'x-request-id', b'req_83b56c72305b1b2399ac27c271663f81'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=DL1c87VrIO2AyhTM2dUEKdjhrAjKC2VsiDt4_LrdwE8-1752619306-1.0.1.1-fEm14XaRJOf87oi8Sg9VCqdqUZKgKDAp6NYSQX8iDJSXILiO9iauiMYJv0W88dFrpt64o4pfqsaaN80Rv9701A2o913dvPNZe8MkTxQhvSk; path=/; expires=Tue, 15-Jul-25 23:11:46 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=Jhsuo2gCiRxdezTK_iF_8zMAkjbbctLFOHtRBufUbSk-1752619306492-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fcc4cb8b5b4f2a-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 18:41:46,829 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 18:41:46,831 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 18:41:46,833 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 18:41:46,833 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 18:41:46,834 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 18:41:46,836 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 15 Jul 2025 22:41:46 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-skjlilaq40lpll1nj6yydmay'), ('openai-processing-ms', '4343'), ('openai-project', 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '4352'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '8960'), ('x-ratelimit-reset-requests', '8.64s'), ('x-ratelimit-reset-tokens', '6.24s'), ('x-request-id', 'req_83b56c72305b1b2399ac27c271663f81'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=DL1c87VrIO2AyhTM2dUEKdjhrAjKC2VsiDt4_LrdwE8-1752619306-1.0.1.1-fEm14XaRJOf87oi8Sg9VCqdqUZKgKDAp6NYSQX8iDJSXILiO9iauiMYJv0W88dFrpt64o4pfqsaaN80Rv9701A2o913dvPNZe8MkTxQhvSk; path=/; expires=Tue, 15-Jul-25 23:11:46 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=Jhsuo2gCiRxdezTK_iF_8zMAkjbbctLFOHtRBufUbSk-1752619306492-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '95fcc4cb8b5b4f2a-MIA'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-07-15 18:41:46,837 - openai._base_client - DEBUG - request_id: req_83b56c72305b1b2399ac27c271663f81
2025-07-15 18:41:46,864 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T18:41:46.864452",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 590,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "what transaction codes were used most frequently?"
}
2025-07-15 18:41:46,870 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T18:41:46.867450",
  "user_question": "what transaction codes were used most frequently?",
  "ai_response": "I'm sorry for the confusion, but the data schema context provided does not include a field for transaction codes in the BKPF (Accounting Document Header) table. The key columns available are company code (BUKRS), document number (BELNR), fiscal year (GJAHR), document type (BLART), posting date (BUDAT), and currency (WAERS).\n\nIf you're looking for transaction codes, they are usually stored in a different table or field, such as TCODE in the CDHDR (Change Document Header) table. Please provide the correct table or field for transaction codes, and I would be happy to assist you further.",
  "processing_time_seconds": 6.45187783241272,
  "data_context": {
    "file_info": {
      "total_rows": "27",
      "total_columns": "14",
      "file_size_mb": "0.0",
      "analyzed_rows": "27"
    },
    "sap_table_type": "BKPF",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "11.11",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "25000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000036.0",
          "mean": "1000000016.56",
          "sum": "25000000414.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "50600.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BLART": {
        "name": "BLART",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "document_type"
        ]
      },
      "BUDAT": {
        "name": "BUDAT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": [
          "posting_date"
        ]
      },
      "WAERS": {
        "name": "WAERS",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "currency"
        ]
      },
      "BKTXT": {
        "name": "BKTXT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "22",
        "unique_percentage": "81.48",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "USNAM": {
        "name": "USNAM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": []
      },
      "TCODE": {
        "name": "TCODE",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "CPUDT": {
        "name": "CPUDT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": []
      },
      "CPUTM": {
        "name": "CPUTM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "19",
        "unique_percentage": "70.37",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2025-07-15T08:15:30",
          "max_date": "2025-07-15T16:45:12",
          "date_range_days": "0"
        },
        "sap_patterns": []
      },
      "XBLNR": {
        "name": "XBLNR",
        "dtype": "object",
        "null_count": 13,
        "null_percentage": 48.15,
        "unique_count": "14",
        "unique_percentage": "51.85",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "AWKEY": {
        "name": "AWKEY",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2.024011510001e+21",
          "max": "2.024061510001e+21",
          "mean": "2.0240281020010002e+21",
          "sum": "5.0600702550025005e+22"
        },
        "sap_patterns": []
      },
      "XREVERSED": {
        "name": "XREVERSED",
        "dtype": "object",
        "null_count": 26,
        "null_percentage": 96.3,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 16.14
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show documents posted in the last 30 days",
      "Which document types have the highest volume?",
      "Find documents with specific posting dates"
    ],
    "schema_summary": "The uploaded file contains 14 columns from a BKPF table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity or department\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BLART: Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)\n    BUDAT: Posting Date - Date when document was posted to the system\n    WAERS: Currency - Document currency code (USD, EUR, etc.)\n    BKTXT: Document Header Text - Description or reference text\n    USNAM: User Name - User who posted the document\n    TCODE: Transaction Code - SAP transaction used to create document\n    CPUDT: CPU Date - System date when document was created\n    CPUTM: CPU Time - System time when document was created\n    XBLNR: Reference Document Number - External reference number\n    AWKEY: Object Key - Internal system key for the document\n    XREVERSED: Reversed Document - Flag indicating if document was reversed",
    "report_identification": {
      "table_type": "BKPF",
      "confidence": "1.0",
      "description": "Accounting Document Header",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BLART",
        "BUDAT",
        "WAERS",
        "BKTXT",
        "USNAM",
        "TCODE",
        "CPUDT"
      ],
      "missing_columns": [],
      "extra_columns": [
        "CPUTM",
        "XBLNR",
        "AWKEY",
        "XREVERSED"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity or department",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BLART": "Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)",
      "BUDAT": "Posting Date - Date when document was posted to the system",
      "WAERS": "Currency - Document currency code (USD, EUR, etc.)",
      "BKTXT": "Document Header Text - Description or reference text",
      "USNAM": "User Name - User who posted the document",
      "TCODE": "Transaction Code - SAP transaction used to create document",
      "CPUDT": "CPU Date - System date when document was created",
      "CPUTM": "CPU Time - System time when document was created",
      "XBLNR": "Reference Document Number - External reference number",
      "AWKEY": "Object Key - Internal system key for the document",
      "XREVERSED": "Reversed Document - Flag indicating if document was reversed"
    }
  }
}
2025-07-15 18:41:47,005 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:47] "POST / HTTP/1.1" 200 -
2025-07-15 18:41:47,067 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:47] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:41:47,112 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:41:47] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:43:11,843 - schema_analyzer - INFO - Schema analysis completed for uploads\ba697c74-f842-4aab-83b3-1aeaf7bc7725_sample_bkpf.csv
2025-07-15 18:43:11,847 - sap_demo.app - INFO - [DEBUG] Detected columns in column_analysis: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:43:11,848 - report_identifier - INFO - Identified report type: BKPF (confidence: 1.00)
2025-07-15 18:43:11,853 - sap_demo.data - INFO - Data Operation: {
  "timestamp": "2025-07-15T18:43:11.853284",
  "operation": "file_uploaded",
  "table": "sample_bkpf.csv",
  "record_count": 27,
  "filters": {
    "session_id": "ba697c74-f842-4aab-83b3-1aeaf7bc7725",
    "file_size_mb": "0.0"
  }
}
2025-07-15 18:43:11,857 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:11] "POST /upload HTTP/1.1" 200 -
2025-07-15 18:43:11,924 - query_planner - INFO - [DEBUG] Parsing question: 'what transaction codes were used most frequently?'
2025-07-15 18:43:11,925 - query_planner - INFO - [DEBUG] Testing pattern: 'most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,925 - query_planner - INFO - [DEBUG] Testing pattern: 'most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,926 - query_planner - INFO - [DEBUG] Testing pattern: 'top (\d+) ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,926 - query_planner - INFO - [DEBUG] Testing pattern: 'top ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,926 - query_planner - INFO - [DEBUG] Testing pattern: 'which ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,927 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,927 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,927 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:11,927 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) were used most frequently[\s\?\.!]*$' - Match: True
2025-07-15 18:43:11,938 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:43:11,938 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:43:11,939 - query_executor - INFO - [DEBUG] Query plan grouping: ['TCODE'], aggregation: {'*': 'count'}
2025-07-15 18:43:11,940 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: DataFrame columns: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:43:11,940 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: grouping=['TCODE'], aggregation={'*': 'count'}
2025-07-15 18:43:11,944 - query_executor - INFO - Query executed successfully in 0.00 seconds
2025-07-15 18:43:11,947 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-57121406-4504-4e09-8e58-a4024cac3206', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BKPF\n- Total Records: 27\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 16.14% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- BLART: document_type\n- BUDAT: posting_date\n- WAERS: currency\n'}, {'role': 'user', 'content': 'what transaction codes were used most frequently?'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 5\n- Execution time: 0.00 seconds\n- Data summary: {'total_rows': 5, 'total_columns': 2, 'column_stats': {}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 18:43:11,950 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 18:43:11,950 - httpcore.connection - DEBUG - close.started
2025-07-15 18:43:11,950 - httpcore.connection - DEBUG - close.complete
2025-07-15 18:43:11,950 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 18:43:11,977 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000211C62A6370>
2025-07-15 18:43:11,977 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000211C5C39240> server_hostname='api.openai.com' timeout=5.0
2025-07-15 18:43:11,994 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000211C62316A0>
2025-07-15 18:43:11,995 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 18:43:11,996 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 18:43:11,996 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 18:43:11,997 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 18:43:11,997 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 18:43:16,529 - query_planner - INFO - [DEBUG] Parsing question: 'what transaction codes were used most frequently?'
2025-07-15 18:43:16,530 - query_planner - INFO - [DEBUG] Testing pattern: 'most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,530 - query_planner - INFO - [DEBUG] Testing pattern: 'most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,530 - query_planner - INFO - [DEBUG] Testing pattern: 'top (\d+) ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,532 - query_planner - INFO - [DEBUG] Testing pattern: 'top ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,532 - query_planner - INFO - [DEBUG] Testing pattern: 'which ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,532 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) are used most[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,533 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most common ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,533 - query_planner - INFO - [DEBUG] Testing pattern: 'what are the most frequent ([\w\s]+)[\s\?\.!]*$' - Match: False
2025-07-15 18:43:16,533 - query_planner - INFO - [DEBUG] Testing pattern: 'what ([\w\s]+) were used most frequently[\s\?\.!]*$' - Match: True
2025-07-15 18:43:16,549 - query_executor - INFO - Dataframe preprocessing completed
2025-07-15 18:43:16,550 - query_executor - INFO - [DEBUG] DataFrame columns at execution: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:43:16,552 - query_executor - INFO - [DEBUG] Query plan grouping: ['TCODE'], aggregation: {'*': 'count'}
2025-07-15 18:43:16,555 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: DataFrame columns: ['BUKRS', 'BELNR', 'GJAHR', 'BLART', 'BUDAT', 'WAERS', 'BKTXT', 'USNAM', 'TCODE', 'CPUDT', 'CPUTM', 'XBLNR', 'AWKEY', 'XREVERSED']
2025-07-15 18:43:16,557 - query_executor - INFO - [DEBUG] _apply_grouping_aggregation: grouping=['TCODE'], aggregation={'*': 'count'}
2025-07-15 18:43:16,563 - query_executor - INFO - Query executed successfully in 0.01 seconds
2025-07-15 18:43:16,569 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-da53543c-0641-4bcf-ab84-f3e07022413e', 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.'}, {'role': 'system', 'content': '\nData Schema Context:\n- Table Type: BKPF\n- Total Records: 27\n- Date Range: Not specified\n- Company Codes: \n- Data Quality: 16.14% null values\n\nKey Columns Available:\n- BUKRS: company_code\n- BELNR: document_number\n- GJAHR: fiscal_year\n- BLART: document_type\n- BUDAT: posting_date\n- WAERS: currency\n'}, {'role': 'user', 'content': 'what transaction codes were used most frequently?'}, {'role': 'system', 'content': "\nQuery Execution Results:\n- Rows returned: 5\n- Execution time: 0.01 seconds\n- Data summary: {'total_rows': 5, 'total_columns': 2, 'column_stats': {}}\n\nPlease provide business insights and recommendations based on these results.\n"}], 'model': 'gpt-4', 'max_tokens': 500, 'temperature': 0.3}}
2025-07-15 18:43:16,573 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-07-15 18:43:16,574 - httpcore.connection - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-07-15 18:43:16,591 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000211C62A7250>
2025-07-15 18:43:16,592 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000211C5C39240> server_hostname='api.openai.com' timeout=5.0
2025-07-15 18:43:16,610 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000211C5AC3700>
2025-07-15 18:43:16,610 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-07-15 18:43:16,612 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-07-15 18:43:16,612 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-07-15 18:43:16,613 - httpcore.http11 - DEBUG - send_request_body.complete
2025-07-15 18:43:16,613 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-07-15 18:43:17,555 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 22:43:17 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'4994'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'4999'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'8960'), (b'x-ratelimit-reset-requests', b'8.64s'), (b'x-ratelimit-reset-tokens', b'6.24s'), (b'x-request-id', b'req_b35d0551b2a0d45cb78ef2619b04fcf0'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fcc6fdfe0ba662-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 18:43:17,557 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 18:43:17,558 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 18:43:17,558 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 18:43:17,558 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 18:43:17,558 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 18:43:17,558 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 15 Jul 2025 22:43:17 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-skjlilaq40lpll1nj6yydmay', 'openai-processing-ms': '4994', 'openai-project': 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '4999', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '8960', 'x-ratelimit-reset-requests': '8.64s', 'x-ratelimit-reset-tokens': '6.24s', 'x-request-id': 'req_b35d0551b2a0d45cb78ef2619b04fcf0', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '95fcc6fdfe0ba662-MIA', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-07-15 18:43:17,559 - openai._base_client - DEBUG - request_id: req_b35d0551b2a0d45cb78ef2619b04fcf0
2025-07-15 18:43:17,560 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T18:43:17.559242",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 792,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "what transaction codes were used most frequently?"
}
2025-07-15 18:43:17,562 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T18:43:17.560242",
  "user_question": "what transaction codes were used most frequently?",
  "ai_response": "I'm sorry for the confusion, but the BKPF table does not contain a field for transaction codes. The transaction code is typically stored in the CDHDR (Change Document Header) table in the 'TCODE' field. This field represents the SAP transaction code that was used to create, change, or delete data.\n\nHowever, in the BKPF table, we have the 'BLART' field which represents the Document Type. Document types include K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document), etc. These document types can give us an idea about the nature of the transactions that were carried out.\n\nIf you are interested in finding out the most frequently used document types, I can assist with that. Please confirm if you would like to proceed with this analysis.",
  "processing_time_seconds": 5.636000633239746,
  "data_context": {
    "file_info": {
      "total_rows": "27",
      "total_columns": "14",
      "file_size_mb": "0.0",
      "analyzed_rows": "27"
    },
    "sap_table_type": "BKPF",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "11.11",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "25000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000036.0",
          "mean": "1000000016.56",
          "sum": "25000000414.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "50600.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BLART": {
        "name": "BLART",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "document_type"
        ]
      },
      "BUDAT": {
        "name": "BUDAT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": [
          "posting_date"
        ]
      },
      "WAERS": {
        "name": "WAERS",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "currency"
        ]
      },
      "BKTXT": {
        "name": "BKTXT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "22",
        "unique_percentage": "81.48",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "USNAM": {
        "name": "USNAM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": []
      },
      "TCODE": {
        "name": "TCODE",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "CPUDT": {
        "name": "CPUDT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": []
      },
      "CPUTM": {
        "name": "CPUTM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "19",
        "unique_percentage": "70.37",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2025-07-15T08:15:30",
          "max_date": "2025-07-15T16:45:12",
          "date_range_days": "0"
        },
        "sap_patterns": []
      },
      "XBLNR": {
        "name": "XBLNR",
        "dtype": "object",
        "null_count": 13,
        "null_percentage": 48.15,
        "unique_count": "14",
        "unique_percentage": "51.85",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "AWKEY": {
        "name": "AWKEY",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2.024011510001e+21",
          "max": "2.024061510001e+21",
          "mean": "2.0240281020010002e+21",
          "sum": "5.0600702550025005e+22"
        },
        "sap_patterns": []
      },
      "XREVERSED": {
        "name": "XREVERSED",
        "dtype": "object",
        "null_count": 26,
        "null_percentage": 96.3,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 16.14
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show documents posted in the last 30 days",
      "Which document types have the highest volume?",
      "Find documents with specific posting dates"
    ],
    "schema_summary": "The uploaded file contains 14 columns from a BKPF table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity or department\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BLART: Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)\n    BUDAT: Posting Date - Date when document was posted to the system\n    WAERS: Currency - Document currency code (USD, EUR, etc.)\n    BKTXT: Document Header Text - Description or reference text\n    USNAM: User Name - User who posted the document\n    TCODE: Transaction Code - SAP transaction used to create document\n    CPUDT: CPU Date - System date when document was created\n    CPUTM: CPU Time - System time when document was created\n    XBLNR: Reference Document Number - External reference number\n    AWKEY: Object Key - Internal system key for the document\n    XREVERSED: Reversed Document - Flag indicating if document was reversed",
    "report_identification": {
      "table_type": "BKPF",
      "confidence": "1.0",
      "description": "Accounting Document Header",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BLART",
        "BUDAT",
        "WAERS",
        "BKTXT",
        "USNAM",
        "TCODE",
        "CPUDT"
      ],
      "missing_columns": [],
      "extra_columns": [
        "CPUTM",
        "XBLNR",
        "AWKEY",
        "XREVERSED"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity or department",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BLART": "Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)",
      "BUDAT": "Posting Date - Date when document was posted to the system",
      "WAERS": "Currency - Document currency code (USD, EUR, etc.)",
      "BKTXT": "Document Header Text - Description or reference text",
      "USNAM": "User Name - User who posted the document",
      "TCODE": "Transaction Code - SAP transaction used to create document",
      "CPUDT": "CPU Date - System date when document was created",
      "CPUTM": "CPU Time - System time when document was created",
      "XBLNR": "Reference Document Number - External reference number",
      "AWKEY": "Object Key - Internal system key for the document",
      "XREVERSED": "Reversed Document - Flag indicating if document was reversed"
    }
  }
}
2025-07-15 18:43:17,654 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:17] "POST / HTTP/1.1" 200 -
2025-07-15 18:43:23,877 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 15 Jul 2025 22:43:23 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-skjlilaq40lpll1nj6yydmay'), (b'openai-processing-ms', b'6893'), (b'openai-project', b'proj_jvOtMmnFhTpGjBEsu2Fn1W5x'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'6895'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000'), (b'x-ratelimit-remaining-requests', b'9998'), (b'x-ratelimit-remaining-tokens', b'8658'), (b'x-ratelimit-reset-requests', b'12.846s'), (b'x-ratelimit-reset-tokens', b'8.046s'), (b'x-request-id', b'req_1f38c9a1448c9cacd18a11da4af638f1'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'95fcc71acdeb9071-MIA'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-07-15 18:43:23,878 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-07-15 18:43:23,878 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-07-15 18:43:23,880 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-07-15 18:43:23,880 - httpcore.http11 - DEBUG - response_closed.started
2025-07-15 18:43:23,881 - httpcore.http11 - DEBUG - response_closed.complete
2025-07-15 18:43:23,881 - httpcore.connection - DEBUG - close.started
2025-07-15 18:43:23,882 - httpcore.connection - DEBUG - close.complete
2025-07-15 18:43:23,882 - openai._base_client - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 15 Jul 2025 22:43:23 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-skjlilaq40lpll1nj6yydmay', 'openai-processing-ms': '6893', 'openai-project': 'proj_jvOtMmnFhTpGjBEsu2Fn1W5x', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '6895', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000', 'x-ratelimit-remaining-requests': '9998', 'x-ratelimit-remaining-tokens': '8658', 'x-ratelimit-reset-requests': '12.846s', 'x-ratelimit-reset-tokens': '8.046s', 'x-request-id': 'req_1f38c9a1448c9cacd18a11da4af638f1', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '95fcc71acdeb9071-MIA', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-07-15 18:43:23,884 - openai._base_client - DEBUG - request_id: req_1f38c9a1448c9cacd18a11da4af638f1
2025-07-15 18:43:23,886 - sap_demo.ai - INFO - AI Request: {
  "timestamp": "2025-07-15T18:43:23.886426",
  "model": "gpt-4",
  "messages_count": 4,
  "response_length": 789,
  "system_prompt": "You are an expert SAP ECC financial data analyst assistant designed for government agencies and enterprise organizations, with specialized knowledge for Department of Defense (DoD) and Navy operations. You help users understand and query SAP financial data through natural language with enterprise-grade precision and compliance awareness.\n\nORGANIZATIONAL CONTEXT:\n- You are assisting Navy personnel and DoD organizations\n- Focus on Navy-specific financial processes, procurement, and compliance requirements\n- Emphasize DoD financial regulations, Navy acquisition processes, and military-specific accounting standards\n- Consider Navy organizational structure, commands, and funding sources\n- Reference Navy-specific terminology and processes when relevant\n\nSAP ECC Financial Tables You Can Work With:\n- BKPF (Accounting Document Header): Document metadata, posting dates, document types, company codes, fiscal years\n- BSEG (Accounting Document Segment): Line items, account assignments, amounts, posting keys, vendor/customer references\n- LFA1 (Vendor Master): Vendor information, addresses, payment terms, blocking status\n- KNA1 (Customer Master): Customer information, addresses, payment terms, blocking status\n- SKAT (G/L Account Master): Chart of accounts, account descriptions, account types\n\nGovernment & Enterprise SAP Financial Concepts:\n- Document Types: K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document)\n- Posting Keys: 40 (Debit), 50 (Credit) for G/L accounts, 01-09 for vendor/customer accounts\n- Company Codes: 4-digit codes representing legal entities or government departments\n- Fiscal Years: YYYY format, critical for government reporting\n- Posting Periods: 01-12 for months, 13-16 for special periods\n- Cost Centers: Government cost allocation and budget tracking\n- Funds Centers: Government fund management and appropriation tracking\n- Business Areas: Government program and activity segregation\n\nNAVY/DOD SPECIFIC CONTEXT:\n- Navy commands, fleets, and shore establishments\n- DoD appropriation categories and funding sources\n- Navy acquisition processes and procurement regulations\n- Military-specific vendor relationships and contracts\n- Navy financial reporting requirements and audit standards\n- DoD compliance with federal financial regulations\n- Navy budget execution and fiscal law compliance\n\nYour Enterprise Capabilities:\n1. Interpret complex natural language queries about SAP financial data\n2. Provide compliance-aware analysis for government regulations and DoD requirements\n3. Suggest relevant data filters and time periods for audit trails\n4. Explain SAP concepts and terminology in Navy/DoD business context\n5. Provide insights on financial trends, anomalies, and compliance issues\n6. Support government reporting requirements and transparency initiatives\n7. Identify potential data quality issues and reconciliation needs\n8. Provide Navy-specific recommendations and best practices\n\nGovernment & Compliance Focus:\n- Emphasize data accuracy and audit trails for DoD requirements\n- Highlight compliance with government accounting standards and Navy regulations\n- Identify potential fraud indicators or unusual patterns\n- Support transparency and public disclosure requirements\n- Ensure proper segregation of duties and access controls\n- Reference Navy-specific financial processes and procedures\n\nAlways provide professional, accurate, and compliance-aware responses suitable for Navy and DoD environments, incorporating relevant Navy terminology and processes when appropriate.",
  "user_message": "what transaction codes were used most frequently?"
}
2025-07-15 18:43:23,892 - sap_demo.app - INFO - User Interaction: {
  "timestamp": "2025-07-15T18:43:23.889828",
  "user_question": "what transaction codes were used most frequently?",
  "ai_response": "I'm sorry for the confusion, but the BKPF table does not contain a field for transaction codes. Transaction codes in SAP are typically used to access specific functionalities or tasks within the system, and they are not usually stored in financial tables like BKPF. \n\nThe BKPF table contains information about the document type (BLART), which can give us insights into the most common types of financial transactions. The document type can be K1 (Customer Invoice), K2 (Customer Payment), S1 (Vendor Invoice), S2 (Vendor Payment), G1 (G/L Document), etc.\n\nIf you need information about the most frequently used transaction codes, you may need to query a different table or system log that tracks user activities and transaction code usage. Please let me know how you would like to proceed.",
  "processing_time_seconds": 7.360048770904541,
  "data_context": {
    "file_info": {
      "total_rows": "27",
      "total_columns": "14",
      "file_size_mb": "0.0",
      "analyzed_rows": "27"
    },
    "sap_table_type": "BKPF",
    "column_analysis": {
      "BUKRS": {
        "name": "BUKRS",
        "dtype": "object",
        "null_count": 0,
        "null_percentage": 0.0,
        "unique_count": "3",
        "unique_percentage": "11.11",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000.0",
          "max": "1000.0",
          "mean": "1000.0",
          "sum": "25000.0"
        },
        "sap_patterns": [
          "company_code"
        ]
      },
      "BELNR": {
        "name": "BELNR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "1000000001.0",
          "max": "1000000036.0",
          "mean": "1000000016.56",
          "sum": "25000000414.0"
        },
        "sap_patterns": [
          "document_number"
        ]
      },
      "GJAHR": {
        "name": "GJAHR",
        "dtype": "float64",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2024.0",
          "max": "2024.0",
          "mean": "2024.0",
          "sum": "50600.0"
        },
        "sap_patterns": [
          "fiscal_year"
        ]
      },
      "BLART": {
        "name": "BLART",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": [
          "document_type"
        ]
      },
      "BUDAT": {
        "name": "BUDAT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": [
          "posting_date"
        ]
      },
      "WAERS": {
        "name": "WAERS",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": [
          "currency"
        ]
      },
      "BKTXT": {
        "name": "BKTXT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "22",
        "unique_percentage": "81.48",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "USNAM": {
        "name": "USNAM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "categorical",
        "patterns": [
          "categorical_values"
        ],
        "sap_patterns": []
      },
      "TCODE": {
        "name": "TCODE",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "5",
        "unique_percentage": "18.52",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "CPUDT": {
        "name": "CPUDT",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "24",
        "unique_percentage": "88.89",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2024-01-15T00:00:00",
          "max_date": "2024-06-15T00:00:00",
          "date_range_days": "152"
        },
        "sap_patterns": []
      },
      "CPUTM": {
        "name": "CPUTM",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "19",
        "unique_percentage": "70.37",
        "data_category": "date",
        "patterns": [
          "date_values"
        ],
        "statistics": {
          "min_date": "2025-07-15T08:15:30",
          "max_date": "2025-07-15T16:45:12",
          "date_range_days": "0"
        },
        "sap_patterns": []
      },
      "XBLNR": {
        "name": "XBLNR",
        "dtype": "object",
        "null_count": 13,
        "null_percentage": 48.15,
        "unique_count": "14",
        "unique_percentage": "51.85",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      },
      "AWKEY": {
        "name": "AWKEY",
        "dtype": "object",
        "null_count": 2,
        "null_percentage": 7.41,
        "unique_count": "25",
        "unique_percentage": "92.59",
        "data_category": "numeric",
        "patterns": [
          "numeric_values"
        ],
        "statistics": {
          "min": "2.024011510001e+21",
          "max": "2.024061510001e+21",
          "mean": "2.0240281020010002e+21",
          "sum": "5.0600702550025005e+22"
        },
        "sap_patterns": []
      },
      "XREVERSED": {
        "name": "XREVERSED",
        "dtype": "object",
        "null_count": 26,
        "null_percentage": 96.3,
        "unique_count": "1",
        "unique_percentage": "3.7",
        "data_category": "text",
        "patterns": [
          "text_values"
        ],
        "sap_patterns": []
      }
    },
    "data_insights": {
      "data_quality": {
        "null_percentage": 16.14
      },
      "business_insights": [],
      "anomalies": []
    },
    "query_suggestions": [
      "Show documents posted in the last 30 days",
      "Which document types have the highest volume?",
      "Find documents with specific posting dates"
    ],
    "schema_summary": "The uploaded file contains 14 columns from a BKPF table.\nColumns:\n    BUKRS: Company Code - 4-digit code representing legal entity or department\n    BELNR: Document Number - Unique accounting document identifier\n    GJAHR: Fiscal Year - Year of the accounting document\n    BLART: Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)\n    BUDAT: Posting Date - Date when document was posted to the system\n    WAERS: Currency - Document currency code (USD, EUR, etc.)\n    BKTXT: Document Header Text - Description or reference text\n    USNAM: User Name - User who posted the document\n    TCODE: Transaction Code - SAP transaction used to create document\n    CPUDT: CPU Date - System date when document was created\n    CPUTM: CPU Time - System time when document was created\n    XBLNR: Reference Document Number - External reference number\n    AWKEY: Object Key - Internal system key for the document\n    XREVERSED: Reversed Document - Flag indicating if document was reversed",
    "report_identification": {
      "table_type": "BKPF",
      "confidence": "1.0",
      "description": "Accounting Document Header",
      "matched_columns": [
        "BUKRS",
        "BELNR",
        "GJAHR",
        "BLART",
        "BUDAT",
        "WAERS",
        "BKTXT",
        "USNAM",
        "TCODE",
        "CPUDT"
      ],
      "missing_columns": [],
      "extra_columns": [
        "CPUTM",
        "XBLNR",
        "AWKEY",
        "XREVERSED"
      ]
    },
    "schema_mapping": {
      "BUKRS": "Company Code - 4-digit code representing legal entity or department",
      "BELNR": "Document Number - Unique accounting document identifier",
      "GJAHR": "Fiscal Year - Year of the accounting document",
      "BLART": "Document Type - Type of accounting document (K1=Customer Invoice, S1=Vendor Invoice, etc.)",
      "BUDAT": "Posting Date - Date when document was posted to the system",
      "WAERS": "Currency - Document currency code (USD, EUR, etc.)",
      "BKTXT": "Document Header Text - Description or reference text",
      "USNAM": "User Name - User who posted the document",
      "TCODE": "Transaction Code - SAP transaction used to create document",
      "CPUDT": "CPU Date - System date when document was created",
      "CPUTM": "CPU Time - System time when document was created",
      "XBLNR": "Reference Document Number - External reference number",
      "AWKEY": "Object Key - Internal system key for the document",
      "XREVERSED": "Reversed Document - Flag indicating if document was reversed"
    }
  }
}
2025-07-15 18:43:24,044 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:24] "POST / HTTP/1.1" 200 -
2025-07-15 18:43:24,139 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:24] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:43:24,168 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:24] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
2025-07-15 18:43:46,625 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:46] "GET / HTTP/1.1" 200 -
2025-07-15 18:43:46,681 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:46] "[36mGET /static/its_consulting_logo_transparent.png HTTP/1.1[0m" 304 -
2025-07-15 18:43:46,694 - werkzeug - INFO - 192.168.1.71 - - [15/Jul/2025 18:43:46] "[36mGET /static/its_consulting_logo_small.png HTTP/1.1[0m" 304 -
